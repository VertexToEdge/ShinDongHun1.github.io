---
title:  "CNU TIME 프로젝트 [발생한 오류들]"
excerpt: "오류모음집"
date:   2021-10-04 10:00:00 +0900
header:
  teaser: /assets/images/spring.png

categories: project
tags:
  - Java
  - Spring
  - MVC
  - JPA
  - project
last_modified_at: 2021-10-04T10:00:00-05:00





---

<br/>

<br/>

수미랑 같이 하는 프로젝트 진행 중, 발생한 N+1에 대한 정리글

<br/>

<br/>

## 2021-10-04, CNU 프로젝트 중 발생한 N+1

<script src="https://gist.github.com/ShinDongHun1/704e71982801a29ce4c6d80ff036c173.js"></script>

다음과 같이 코드를 작성하면,  쿼리가 총 두 번 실행된다

findById는 Member를 fetch join 하지 않기 때문에, 두번째 조건문에서 member를 찾아오는 쿼리가 한번 더 나가게 된다.

![image-20211004152958127](https://raw.githubusercontent.com/ShinDongHun1/image_repo/main/img/image-20211004152958127.png)

페치조인으로 해결한 코드는 다음과 같다.

```java
@Query("select p from Post p join fetch p.writer w where p.id = :id")
Optional<Post> findWithMemberById(@Param("id")Long id);
```

<script src="https://gist.github.com/ShinDongHun1/47fcd1b0ad4cacce71632781563e2a13.js"></script>

![image-20211004153140570](https://raw.githubusercontent.com/ShinDongHun1/image_repo/main/img/image-20211004153140570.png)

하면 할수록 뭔가 더 쉬워지고, 어디서 N+1이 터질 지, 어떻게 해결해야 할 지 예상이 된다.

<br/>

<br/>

## 2021-10-04

#### <span style="color:red">java.lang.IllegalStateException: Failed to load ApplicationContext</span>

전체 메세지

##### <span style="color:red">Caused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'postServiceImpl' defined in file </span>[C:\cnupost\cnupost\out\production\classes\com\cnutime\cnupost\service\post\PostServiceImpl.class]: Unsatisfied dependency expressed through constructor parameter 0; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'postRepository' defined in com.cnutime.cnupost.repository.post.PostRepository defined in @EnableJpaRepositories declared on JpaRepositoriesRegistrar.EnableJpaRepositoriesConfiguration: Invocation of init method failed; nested exception is org.springframework.data.repository.query.<span QueryCreationException: Could not create query for public abstract java.util.List com.cnutime.cnupost.repository.post.PostRepository.findAllOrderByRecommendDesc()! <span style="color:red">Reason: Failed to create query for method public abstract java.util.List </span>.com.cnutime.cnupost.repository.post.PostRepository.findAllOrderByRecommendDesc()! No property desc found for type int! Traversed path: Post.recommend.; nested exception is java.lang.IllegalArgumentException: Failed to create query for method public abstract java.util.List com.cnutime.cnupost.repository.post.PostRepository.findAllOrderByRecommendDesc()! No property desc found for type int! Traversed path: Post.recommend.



뭔가 이해는 안되지만,  스프링 데이터 JPA의 작명방식을 따라 메소드명을 짓지 못한 거 같았다.

```java
List<Post> findAllOrderByViewsDesc();
```

이를

```java
List<Post> findAllByOrderByViewsDesc();
```

이렇게 바꿔주니 해결되었다.