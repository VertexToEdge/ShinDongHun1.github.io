---
title:  "CNU TIME[2]"
excerpt: "Member 수정하고, Post 기능 추가하기"
date:   2021-09-27 13:28:00 +0900
header:
  teaser: /assets/images/spring.png

categories: CNUTime
tags:
  - Java
  - Spring
  - MVC
  - JPA
  - project
last_modified_at: 2021-09-27T13:28:00-05:00




---

<br/>

<br/>

오늘 원래 만나서 기능들이랑 이것저것 결정해보려 했는데 수미 아파서 못했다..

그래서 일단 나 혼자 조금 구현해보았다.

기본적인 엔티티들을 만들었고, 연관관계를 우선 단방향으로만 설정했다.

<br/>

<br/>

### 💻 Member -수정 전

<script src="https://gist.github.com/ShinDongHun1/e7d01827bc5f5463dcfd625eb90dd500.js"></script>

### 💻 Member -수정 후

<script src="https://gist.github.com/ShinDongHun1/e6a1df36700678d8e29518fc630aa3b5.js"></script>

**우선 Entity에는 Setter를 두지 않는것이었다. 저번에 내가 본 글에서는 DTO에도 setter를 두지 말라 해서 Entity에  Setter를 뒀었는데 완전 미친짓이었다는것을 깨달았다.**

**우선 기본 키 생성 전략을 어떻게 해결해야 할 지 몰라서 default값으로 설정해두기로 했다.** 

**Username은 유일한 속성이나, 아이디를 변경할 가능성도 충분히 있으며, 비즈니스 로직을 PK로 사용하는 것은 좋지 않다는 선생님의 말씀을 따라.. 바꿔주었다.**

**Setter를 제거하니, 회원가입 시간을 외부에서 설정할 수가 없어서, 회원가입 시간을 정해주는 의미있는 메소드를 하나 만들었다.**

[참고 - 엔티티 setter](https://www.inflearn.com/questions/16235)

<br/>

<br/>

### 💻 H2MemberRepository

<script src="https://gist.github.com/ShinDongHun1/bb2f203efd693fdf22d6017e349e973b.js"></script>

**PK값을 바꿨기 때문에, Username으로 회원을 찾아주는 코드도 수정이 필요했다.  Optinal.ofNullable(null) 을 통해, 찾은 회원이 없으면 null값을 넣어주도록 했는데 잘 한 것인지 모르겠다..**

<br/>

<br/>

### 💻 MemberServiceImpl

<script src="https://gist.github.com/ShinDongHun1/43232dbacef7784155c2e9cf394630f0.js"></script>

**Member가 바껴도 MemberService는 바뀌지 않았다! 잘 한 것 같다 :D**

**요렇게 의존관계 주입 방식을 생성자 주입 방식으로 바꿔주었다**

<br/>

<br/>

### 💻 MemberDTO 수정 전

<script src="https://gist.github.com/ShinDongHun1/113c6406f080598c763e49fe234cadff.js"></script>

### 💻 MemberDTO 수정 후

<script src="https://gist.github.com/ShinDongHun1/55774e01c154456a79bf0f84a96c87e4.js"></script>

@Setter가 없어도 잘 동작하지만, 후에 Get 방식으로 Http 요청을 받을 때 사용할 일이 생길 수도 있을 거 같아서 넣어주었다. 

나중에 사용할 필요가 없어지면 빼야겠다!

[참고 - DTO에 Setter가 필요없다?](https://jojoldu.tistory.com/407)

<br/>

<br/>

#### 여기까지가 저번에 짠 코드 수정이었고, 지금부터는 새로운 코드들이다.

### 💻 Post

<script src="https://gist.github.com/ShinDongHun1/6b09160709d2bf1f084bfeb86d1b6220.js"></script>

**아직 완전히 어떤 방식으로 구현할지는 몰라서, 우선 나의 생각대로 설정해주었다.**

**게시글은, PK값인 id를 가지고 있다.**

**게시글은 게시판에 속하므로, 게시판과의 관계는 N:1 관계이므로, 연관관계의 주인은 게시글이며, 따라서 JoinColumn을 통해 매핑시켜주었다.**

**또한 한명의 회원이 여러 게시물을 쓸 수 있으므로, 게시물과 회원의 관계도 N:1이다.**

**게시글의 길이는 어느정도로 할 지 몰라서, 일단 글의 내용이 많아도 가능하도록 @Lob를 붙여주었다.**

**게시글에는 댓글들도 달려있으나, 아직 이곳에는 설정해 주지 않았다. 게시글과 댓글들의 관계에서, 연관관계의 주인은 댓글이므로, 우선 단방향으로만 코드를 작성하기로 했기때문에 여기에 넣어주지는 않았다.**

(참고로 방금 @Column에 주석처리가 되어있는 것을 보아서 주석을 제거해주었다.)

<br/>

<br/>

### 💻 Comment

<script src="https://gist.github.com/ShinDongHun1/e793f217f893f4982bd1d5f044d458a0.js"></script>

##### Post와 비슷하다 :D

<br/>

<br/>

### 💻 BigComment

<script src="https://gist.github.com/ShinDongHun1/bdd3603f398e70f343bab2d0bb053068.js"></script>

대댓글을 어떻게 해야할 지 모르겠다. 댓글에 대한 정보만 있으면 될 것 같기도 한데.. 어느 게시물에 남겨진 대댓글인지도 알아야 할 거 같고... 그러자니 댓글만 있어도 어떤 게시물인지는 알 수 있긴 한데... 

#### 아마 여기서 Post는 나중에 제거하지 않을까 싶다! 아무리 생각해도 필요가 없어보인다.

#### 근데 왜 남겨놨냐고..? 확신이 아닌 의심이라... 나 너무 멍청쓰 하다..

<br/>

<br/>

### 💻 BulletinBoard

<script src="https://gist.github.com/ShinDongHun1/1c0345d4ed590626c291d7cd8e886ef0.js"></script>

##### 아직 어떻게 할 지 몰라서... 일단 이렇게만 만들어 주었다.

##### 아마 게시판에도 다 역할을 부여할 것 같은데, 나중에 수미 만나서 회의해보고 추가할 것임!

<br/>

<br/>

#### 그리고 저번에는 직접 postman을 사용하여 테스트를 해보았는데, 이번부터는 Test코드를 작성하며 하기로 했다.

#### Postman으로만 하자니 너무 귀찮고, 데이터를 넣어주기도 힘들었으며, 테스트 코드를 작성하는 연습이 필요할 거 같아, 해보기로 했다.

### 💻 MemberServiceTest 

<script src="https://gist.github.com/ShinDongHun1/eee851d80293792dd8d8217fdaa27ccb.js"></script>

**근데 나만 알아볼 수 있는 테스트 코드인것 같다. 작성이 처음이라 이런식으로 작성하는 것이 맞는지도 모르겠고.. 가독성도 떨어진다.**

**후에 천천히 고쳐봐야겠다**

#### 이렇게 회원 서비스 관련 구현은 우선 마무리 지었다. 물론 아직 할것이 많다. 생성자에서 유효성 검사도 해야하고(예를들어 아이디는 한글을 입력하면 안된다.).. 할게 많지만 당장 그렇게까지 깊게 들어가는것은 좋지 않다고 생각하여 남겨두었다.

#### 아래 코드부터는 게시물 서비스 구현 코드이다.

<br/>

<br/>

### 💻 JpaPostRepository

<script src="https://gist.github.com/ShinDongHun1/c7bb77dec994c054d5666229740e850a.js"></script>

인터페이스 부분의 코드는 생략하겠다.

member와 비슷하지만, update와 delete 기능이 추가되었다. 

update를 하는 방법에는 두가지가 있었다

- merge를 사용
- 내가 한 방법

선생님께서 merge보다는 이 방법이 더 좋은 방법이라 하셔서 이렇게 작성했다!

[참고 - 실전! 스프링 부트와 JPA 활용 1, 변경 감지와 병합(merge) ](https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81%EB%B6%80%ED%8A%B8-JPA-%ED%99%9C%EC%9A%A9-1/lecture/24309?tab=curriculum)

<br/>

<br/>

### 💻 PostServiceImpl

<script src="https://gist.github.com/ShinDongHun1/43165c6048cd17f47c6f165798107287.js"></script>

##### 



<br/>

<br/>

### 💻 PostServiceImplTest

<script src="https://gist.github.com/ShinDongHun1/dde4ed7014e8c1caeb05f7cae3779adb.js"></script>

테스트 코드인데.. 먼가 좀 아닌거같다..ㅋㅋㅋ큐ㅠㅠㅠㅠㅠㅠㅠㅠㅠ

<br/>

<br/>

## 수정하거나 고민이 필요한 부분

<br/>

#### Member와, Post등의 PK값 생성 전략.

- ##### 현재는 Member와 Post가 동일하게 올라감. 예를 들어 회원 두명이 가입하고, 글 3개를 쓴다면 회원의 id는 1,2 이고 게시물은 3,4,5 가 된다.

<br/>

#### MemberDTO에 @Setter 여부

<br/>

#### BigComment가 Post와 연관관계가 필요한지

<br/>

#### 단방향 연관관계로 충분한지, 양방향이 필요하진 않을지.

<br/>

### PostServiceImpl에서 

- ##### uploadPost를 하면 Post 객체가 반환되도록 설정하였는데, void를 반환하는 것으로 바꿀지 말지.

- ##### updatePost의 인자로 Post를 넣을지 post의 Id(PK값)를 넣을지 고민.

<br/>

<br/>

## 공부할때 참고할것

Application.properties

<script src="https://gist.github.com/ShinDongHun1/010c17ff1b184329f9c178a1945dc609.js"></script>

### 