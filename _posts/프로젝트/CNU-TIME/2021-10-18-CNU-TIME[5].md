---
title:  "CNU TIME[5]"
excerpt: "페이지 접근 권한 부여, 예외 처리"
date:   2021-10-18 05:28:00
header:
  teaser: /assets/images/spring.png

categories: CNUTime
tags:
  - project
last_modified_at: 2021-10-18T05:28:00

---

<br/>

<br/>

### 페이지 접근 권한 부여

<script src="https://gist.github.com/ShinDongHun1/2c411e6b35a79b1c92a4c41577c1f8d6.js"></script>

<script src="https://gist.github.com/ShinDongHun1/b07086a5221848300b840ce9c0c60270.js"></script>

오늘 공부한 스프링 인터셉터를 가지고, 로그인을 한 사용자만 페이지에 접근할 수 있도록 코드를 짜보았다.

<br/>

추가로 세션을 유지하여, 사용자의 정보를 계속 가지고 있도록 하였는데, 이를 통해 포스트의 CRUD 등과 같이, 사용자의 정보가 필요한 기능들에서, 사용자의 정보를 받아올 필요가 없어졌다.

<br/>

#### 코드로 확인해보자

##### 원래 코드

<script src="https://gist.github.com/ShinDongHun1/447c7c8c7f362580c5a7750dddd70300.js"></script>

해당 코드의 RequestMyPostDto 는 username를 받아와서 사용해야 했다.

![image-20211018053538605](https://raw.githubusercontent.com/ShinDongHun1/image_repo/main/img/image-20211018053538605.png)

그러나 이제는 세션을 통해 사용자의 정보를 유지하므로 이럴 필요가 없어졌다.

##### 바뀐 코드

<script src="https://gist.github.com/ShinDongHun1/c7309bfa54a873d6b5aafc11bcff7b86.js"></script>

##### @Login은 해당 사용자가 인증이 되었는지(세션이 존재하는지), 확인해주는 어노테이션으로, 내가 직접 만들었다.

<br/>

##### 등록법은

<script src="https://gist.github.com/ShinDongHun1/4013fcd3f4fbb8ea549a718e8e5ea350.js"></script>

##### 난 파라미터에 사용할 것이기 때문에 @Target(ElementType.PARAMETER)를 해주었고,

<br/>

<script src="https://gist.github.com/ShinDongHun1/4f42e0b04f8b593eeb8796a9fa2b37e7.js"></script> 

##### HandlerMethodArgumentResolver를 구현한 LoginMemberArgumentResolver를 다음과 같이 등록시켜 줌으로서 사용했다.

![image-20211018054404455](https://raw.githubusercontent.com/ShinDongHun1/image_repo/main/img/image-20211018054404455.png)

<br/>

<br/>

<br/>

## 예외 처리

<script src="https://gist.github.com/ShinDongHun1/5cc48b5a98ee582e1a04a285aeda591a.js"></script>

##### 스프링 부트가 제공하는 WebServerFactoryCustomizer을 구현함으로써 에러페이지를 만들어주었다.

##### MemberException이 발생하면 /error/member 의 경로로 이동되고, 나머지도 보이는것과 같다.

<br/>

<br/>

#### 예외 처리 컨트롤러

<script src="https://gist.github.com/ShinDongHun1/ded878d79ae8ef5b796061db8b0ef388.js"></script>

#### 참고

- ##### request.attribute에 서버가 담아준 정보

  - javax.servlet.error.exception : 예외

##### 예외 처리는 아직 제대로 배우지 않아서, [신영이의 블로그](https://velog.io/@sinyoung3016/%EC%B0%A8%EA%B7%BC%EC%B0%A8%EA%B7%BC-%EA%B8%B0%EC%B4%88-%EB%8B%A4%EC%A7%80%EA%B8%B0-04-BackEnd-H2-Exception)를 조금 참고하여 만들어보았다.