---
title:  "CNU TIME[1]"
excerpt: "객체 연관관계 설정하기, 로그인 구현하기"
date:   2021-09-26 05:28:00 +0900
header:
  teaser: /assets/images/spring.png

categories: project
tags:
  - Java
  - Spring
  - MVC
  - JPA
  - project
last_modified_at: 2021-09-26T05:28:00-05:00



---

<br/>

<br/>

#### 이 글은 정보 공유글이 아니며 그냥 제가 프로젝트 하면서 애먹었던 부분이나 느낀점들을 기록하는 글입니다.

<br/>

<br/>

JPA와 MVC에 대해서 아직 제대로 숙지하지는 못했지만, 실제로 코딩하면서 배우는게 제일 빠르기에 지금까지 배운 내용들을 토대로 코드를 작성해보았다.

JPA를 한번 공부하고, MVC를 공부한 이후 했는데, JPA가 정말 기억이 안나서 거의 보고 따라치는 수준이었다.. 

정말 간단한 작업이었는데 엄청 오래 걸렸다. 한7시간정도??

일단 내가 설계한 객체 연관관계는 다음과 같다.

### 💻 객체 연관관계 설정

![객체 연관관계 설계](https://raw.githubusercontent.com/ShinDongHun1/image_repo/main/img/%EA%B0%9D%EC%B2%B4%20%EC%97%B0%EA%B4%80%EA%B4%80%EA%B3%84%20%EC%84%A4%EA%B3%84.png)

사실 월요일에 수미랑 만나서 구성하려 했는데... 

객체의 연관관계나 도메인 모델, 테이블 등을 설계하는 능력을 기르고 싶어서 일단 혼자서 조금 해보았다.

월요일에 수미 만나서 같이 얘기한 후 수정해야겠다!

<br/>

일단 게시물에 대해서는 얘기를 진행하지 않았기 때문에, 제일 만만한 로그인을 구현해보기로 했다.

(사실 스프링 시큐리티를 공부하고 싶었는데 당장 JPA랑 MVC도 제대로 못 하는데 너무 욕심인 것 같아서, 후에 시큐리티를 사용하여 코드를 수정해보려 한다 :D)

<br/>

설계부터 굉장히 고민이었다. DTO를 사용해 본 적이 없어서, 정확이 어떻게 사용해야 하는줄도 몰랐고, 그냥 평소처럼 한다면 실력을 늘리는것도 불가능 할 것 같아서, 이것저것 찾아보며 공부해서 일단 작성해 보았다. 계속 공부하면서 잘못 설계했던 부분이나, 고칠 것들이 있으면 수정할 것이니, DTO 그렇게 짜는 거 아닌데... 해주면 감사하겠습니당 ㅎㅎ(좀 알려주세여 ㅠ)

<br/>

<br/>

### 💻 Member

<script src="https://gist.github.com/ShinDongHun1/e7d01827bc5f5463dcfd625eb90dd500.js"></script>

JPA에서 배웠던 내용을 떠올리며 작성해 보았다. 우선 데이터베이스 안 쓰고 하려 했지만, 이왕 하는거 쓰는게 좀 더 괜찮을 것 같아서 쓰기로 했다.

매핑을 해야하는데 처음부터 난관이었다.

지금까지 Long에만 @Id를 붙였는데, 이게 String에 붙여도 되는건가.. 싶어서 찾아봤더니 가능 ㅎㅎ. 

아이디는 중복이 불가능하니 아이디에 @Id를 붙여주었다.

#### <span style = "color:red">그런데 갑자기 생각났는데, 전에 강의들을 때 비즈니스 로직과 관계있는 값을 PK로 두면 좋지 않다고 했었던 것 같다. (예를 들어 주민번호나 전화번호를 PK값으로 하는것이 별로 좋지 않은 방법이었다고..) </span>

그래서 내일 수정하려 한다!

#### (자바 ORM 표준 JPA 프로그래밍 - 기본편, 기본 키 매핑, 19분 40초에서 설명해주심!)

##### 아무튼 너무 내가 멍청하다 느낀게 primary key로 String을 썼으면서 @GeneratedValue를 붙여서 계속 오류가 나서 애먹었다..

<br/>

##### Enum 타입을 사용하는 것도 문제였다. @Enumerated와 @Embadded, @Embaddable을 계속 헷갈려서 시간 엄청 날렸다..

##### (데이터베이스에 Enum이 저장이 안 되서 도대체 강의랑 똑같이 하는데 뭐가 문제지??? 했는데 Grade에 @Embaddable을 붙여놔서 안됐던 것임...)

### 💻 Grade

<script src="https://gist.github.com/ShinDongHun1/ac4f09d75e03f7fafed244747a41e6f5.js"></script>

학생회나, 동아리 임원들이 중요 공지를 게시할 수 있게 등급을 나누어줬다.

<br/>

<br/>

### 💻 MemberRepository

<script src="https://gist.github.com/ShinDongHun1/73b6c4dfa9708cc5263dbeeaef919bba.js"></script>

회원을 저장하고, 찾아오는 역할을 하는 인터페이스이다.

원래였으면 그냥 바로 클래스로 만들었을텐데, 요즘 객체지향 관련해서 이것저것 읽어가며, 이상적으로는 모든 설계에 인터페이스와 구현체로 나누는 것이 좋다길래 해보았다. (물론 무지성으로 그런것은 아님.) 

앞으로도 계속 이런식으로 코드를 짜보려고 노력할것이다!

아직 많이 부족한거 누구보다 잘 안다..ㅠ

<br/>

<br/>

### 💻 H2MemberRepository

<script src="https://gist.github.com/ShinDongHun1/b2882988f1c3035495bf5f31a47aedec.js"></script>

이것도 지금보니 이름을 잘못 지은 것 같다. H2 데이터베이스든 Oracle 데이터베이스던 다르게 구현하는 부분이 없는데 이름을 H2로 지어버렸다. 나중에 수정해야겠다.

#### <span style = "color:red">@PersistenceContext는 내가 정말 배운 기억도 없다.. 다시 JPA를 들으며 공부해야겠다!!!</span>

근데 나 나름 jpa 열심히 공부한거 같았는데.. 2번이나 했는데도 기억이 없는걸 보면 진짜 속상하다 ㅠㅠㅠ

```
member.setJoinDateTime(LocalDateTime.now())
```

LocalDateTime.now()를 통해, 이 코드가 실행되는 시점을 회원가입 시간으로 설정해주었다.

#### findByUsername 메소드에서는 Optional\<Member> 이 반환되는데, 저번에 살짝 공부한 내용으로는 Optional\<T>은 null 처리를 하는데 많은 도움을 준다고 했었던 것 같았다. 

> Optional\<T> 클래스는 Integer나 Double 클래스처럼 'T'타입의 객체를 포장해 주는 래퍼 클래스(Wrapper class)입니다. 따라서 Optional 인스턴스는 모든 타입의 참조 변수를 저장할 수 있습니다.
>
> 이러한 Optional 객체를 사용하면 예상치 못한 NullPointerException 예외를 제공되는 메소드로 간단히 회피할 수 있습니다. 즉, 복잡한 조건문 없이도 널(null) 값으로 인해 발생하는 예외를 처리할 수 있게 됩니다.
>
> [TCP 스쿨 - Optional 클래스](http://tcpschool.com/java/java_stream_optional)

조금 더 공부해 보아야겠다.

#### 전에 JPA를 공부하며 싱글톤과 막 뭐 이것저것 하면서 공유되는 변수 사용을 주의하라 하셨는데, 사실 이부분도 잘 기억이 나지 않았다.. 코드를 일단 작성을 했으나, 다음에 다시 공부하면서 수정해야 할 것 같다. (일단 내가봤을때는 공유되는 변수가 없으니 별 문제는 없을 것 같다만.. 확신이 아닌 의심이므로, 애당초 공부가 덜 됐다는 증거기도 하다 :(  ) 

<br/>

<br/>

### 💻 MemoryMemberRepository

<script src="https://gist.github.com/ShinDongHun1/643013da5d516b7afd6d2d25d90606b3.js"></script>

이건 데이터베이스를 쓰지 않고 해보려 했다가.. 결국 사용하겠다는 결정을 내림으로써 사용하지 않게 된 코드이다. 그래도 코드상에 문제는 없어보인다. 

<br/>

<br/>

### 💻 MemberService 

<script src="https://gist.github.com/ShinDongHun1/01cec17d5585b4bfa772b4a6dec9b99b.js"></script>

회원가입, 회원 검색, 모든 회원 출력, 로그인 기능을 제공해주는 MemberSerivce 인터페이스이다!

<br/>

<br/>

### 💻 MemberServiceImpl

<script src="https://gist.github.com/ShinDongHun1/3da220a5839e6bdadb13fc455fbf5789.js"></script>

```
private MemberRepository memberRepository;
```

의존성 주입을 필드 주입 방식으로 해주었다. 이러면 안 좋다는 것은 기억나는데, 나중에 다시 공부 조금 더 하고 다른 방식(아마 생성자 주입)으로 바꿀 예정이다. 

강의를 볼 때는 의존성 주입 다 이해했고, 선생님의 코드를 따라 칠 때는 어렵지 않았는데 혼자 하려니 너무 힘들었다. 게다가 MVC 하다 와서 기억도 잘 안나니까 죽을맛이었다 :(

오류를 만드는 부분도 어떻게 구현해야할지 잘 모르겠어서 일단 내 마음대로 해보았다. 저것도 천천히 공부해가면서 수정할 예정이다.

<br/>

<br/>

### 💻 MemberException

<script src="https://gist.github.com/ShinDongHun1/b2dfad06908ce2481facc538928ae6fb.js"></script>

오류 만드는것을 군 입대 전 팀프로젝트에서 한 이후 한번도 해본적이 없어 살짝 애먹었다...ㅎ... 뭔가 너무 초라하고 이것저것 추가해야 할 것 같지만, 지금 에러부분을 공부하기엔 JPA랑 MVC에서 공부할것들이 너무 많다. 나중에 정말 필요해지거나, 그런게 아니라면 어느정도 스프링에 익숙해진 이후 고칠 것 같다:D

<br/>

<br/>

### 💻 MemberDTO

<script src="https://gist.github.com/ShinDongHun1/113c6406f080598c763e49fe234cadff.js"></script>

이부분도 할 말이 많다. 우선 아직 내가 데이터베이스를 제대로 공부한 것도 아니고, 도메인, 엔티티.. 개념들이 잘 잡혀있지 않은 상태이다. DTO를 이렇게 작성하는것이 맞나 싶기도 하고.. 너무 어려웠다.

그리고 찾아보니 DTO에는 Setter를 넣으면 안되는 것 같았다.

그런데 Setter를 안넣으니까 아래 Controller 부분에서 @RequestBody 로 MemberDTO를 받아올 수가 없었다.

데이터를 주고받는데 DTO를 사용하는데, 이러면 주고받을 수 없지않나???? 싶었으나, 아니었다.

아직 정확히는 모르겠지만, response로 응답을 보낼 때 DTO 형식으로 보내면 되는 것 같았다.

(무조건 틀린게 맞겠지만 아직 저 너무 멍청해서 그냥 일단 이런식으로 이해하고 나중에 공부 열심히 해서 꼭 배울거임... 진짜 꼭 다 공부할거임)

<br/>

<br/>

### 💻 MemberController

<script src="https://gist.github.com/ShinDongHun1/ecdbdcf4ca258502ab9f7d63a05f24a0.js"></script>

아 여기 진짜 헬.. 완전 헬이었다!!!! 진짜 별거 아닌것처럼 보일 수 있는데, 거의 그냥 아무것도 모르는 상태로 코딩한 느낌이다. 분명 배웠는데 실제로 써보려니까 어떻게 해야할지 모르겠더라...

우선 지금 보니 고쳐야 할 점이 보인다.

나는 React와 통신을 해야하기 때문에, JSON을 사용하여 API제공할 것이다. 따라서 나는 화면을 이동시킬 필요가 없기 때문에, @Controller 대신에 @RestController를 사용하는게 @ResponseBody를 사용하지 않아도 되기 때문에 코드가 더 깔끔해졌을텐데 하는 생각이 든다! 수정해야겠다. 

로그인에 실패하거나, 회원가입에 실패했을 경우에는 응답을 도대체 어떻게 줘야 할 지 모르겠었다. 지금도 모르는데 그냥 내 맘대로 생각해서 해본것이다.

맨 처음에는 그냥 return "로그인에 성공했습니다"; , 혹은 "로그인에 실패했습니다" 이런 식으로 작성했는데, 이건 너무 아닌 것 같았다. 

그래서 상태코드를 사용하는 법을 살짝 구글링해보았고, 성공했을 경우에는 Member의 데이터를 JSON 형식으로 돌려주며, 상태코드는 200을,

실패했을 경우에는 상태코드 401(Unauthorized)과 함께, 실패한 이유를 단순 text로 보내주었다. postman을 사용해서 실험한 결과 잘 나왔다!. 

#### 상태코드 401을 쓰는 것이 맞는지, 애당초 이런 식으로 데이터를 주고받는것이 옳은 것인지 잘 모르겠으나, 아직은 난 공부를 막 시작한 단계이고, 계속 공부하면서 틀린부분은 고쳐나갈 것이기 때문에 일단은 이렇게 사용해보기로 했다.

<br/>

<br/>

#### 이렇게 오늘 정말 간단한 회원가입과, 로그인을 수행하는 기능을 만들어봤는데, 정말 어려웠다. 계속 이론공부만 했으면 깨닫지 못했을 내용들을, 스스로 프로그램을 만들며보며 내가 무엇을 잘 모르고(사실 다 모르지만), 무엇이 부족한지 잘 느끼게 해주었다. 또한 이렇게 시행착오를 겪으며 해결한 부분은 기억에도 더 오래 남을 것이다.

#### 나는 정말 많이 부족하다. 원래도 알고 있었지만 오늘 더더욱 느꼈다. 진짜 열심히 공부하고 열심히 배워서, 스프링 잘 하는 멋진 19학번 오빠(선배)가 되고싶다 :D
