---
title:  "Hint & Lock"
excerpt: "Hint & Lock"
date:   2021-10-26 07:20:00
header:
  teaser: /assets/images/spring.png

categories: DATA
tags:
  - Java
  - Spring
  - JPA
  - DATA JPA
  - Hint
  - Lock
last_modified_at: 2021-10-26T07:20:00

---

<br/>

## ğŸ’¡ Hint

##### jpa ì¿¼ë¦¬ë¥¼ ë‚ ë¦´ ë•Œ JPAêµ¬í˜„ì²´(í•˜ì´ë²„ë„¤ì´íŠ¸)ì—ê²Œ ì•Œë ¤ì£¼ëŠ” íŒíŠ¸ì´ë‹¤.

```java
Member member1 = new Member("member1", 10);
memberRepository.save(member1)l
em.flush();
em.clear();

Member findMember = memberRepository.findById(member1.getId()).get();
findMember.setUsername("member2"); //ë³€ê²½ê°ì§€ ë°œìƒ

em.flush(); // member1ì˜ ì´ë¦„ì´ member2ë¡œ ë³€ê²½
```

##### ë³€ê²½ ê°ì§€ì˜ ì¹˜ëª…ì  ë‹¨ì  : ìŠ¤ëƒ…ìƒ·ì´ ìˆì–´ì•¼ í•œë‹¤(ì›ë˜ ìƒíƒœë¥¼ ì €ì¥í•œ ê°ì²´)

##### ë”°ë¼ì„œ ë¹„íš¨ìœ¨ì ì´ë©°, ë©”ëª¨ë¦¬ë¥¼ ë” ì°¨ì§€í•˜ê²Œ ëœë‹¤.

<br/>

### ë§Œì•½ ë³€ê²½í•˜ì§€ ì•Šê³  ì¡°íšŒë§Œ í•˜ê³  ëë‚¼ê±°ë¼ë©´ ì´ë¥¼ ìµœì í™” í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì´ ìˆë‹¤.

#### ğŸ¹ @QueryHints ì‚¬ìš©

```java
@QueryHints(value = @QueryHint(name = "org.hibernate.readOnly", value = "true"))
Member findReadOnlyByUsername(String username);
```

<br/>

```java
Member member1 = new Member("member1", 10);
memberRepository.save(member1)l
em.flush();
em.clear();

Member findMember = memberRepository.findReadOnlyByUsername(member1.getId()).get();
findMember.setUsername("member2"); //ë³€ê²½ê°ì§€ ë°œìƒX

em.flush(); // ì´ë¦„ì´ ë³€ê²½ë˜ì§€ ì•ŠëŠ”ë‹¤
```

<br/>

<br/>

## ğŸ’¡ Lock

```java
@Lock(LockModeType.PESSIMISTIC_WRITE)
List<Member> findLockByUsername(String username);
```

##### Lockì— ëŒ€í•´ì„œëŠ” ì•„ì§ ì¢€ ì–´ë ¤ì›Œì„œ ë‚˜ì¤‘ì— ê³µë¶€í•œ í›„ ìˆ˜ì •í•˜ê² ë‹¤.

##### ìš°ì„ ì€ JPAì—ì„œ ì œê³µí•˜ëŠ” Lockì„ í¸ë¦¬í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤ ì •ë„ë¡œë§Œ ì•Œì•„ë‘ì.

<br/>

<br/>

<br/>

### ğŸ“” Reference

[ì¸í”„ëŸ° - ì‹¤ì „! ìŠ¤í”„ë§ ë°ì´í„° JPA](https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81-%EB%8D%B0%EC%9D%B4%ED%84%B0-JPA-%EC%8B%A4%EC%A0%84/dashboard)

[JPA ë¹„ê´€ì  ì ê¸ˆ(Pessimistic Lock)](https://isntyet.github.io/jpa/JPA-%EB%B9%84%EA%B4%80%EC%A0%81-%EC%9E%A0%EA%B8%88(Pessimistic-Lock)/)

[JPAì—ì„œ Optimistic Lockê³¼ Pessimistic Lock](https://skasha.tistory.com/49)