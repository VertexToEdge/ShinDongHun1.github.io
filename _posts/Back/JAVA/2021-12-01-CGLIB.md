---
title:  "CGLIB"
excerpt: "Code Generator Library"
date:   2021-12-01 19:50:00 
header:
  teaser: /assets/images/spring.png

categories: java
tags:
  - Java
last_modified_at: 2021-12-01T19:50:00





---

<br/>

<br/>

## ğŸ’¡ CGLIB

CGLIB: Code Generator LibraryëŠ” ë°”ì´íŠ¸ì½”ë“œë¥¼ ì¡°ì‘í•´ì„œ ë™ì ìœ¼ë¡œ í´ë˜ìŠ¤ë¥¼ ìƒì„±í•˜ëŠ” ê¸°ìˆ ì„ ì œê³µí•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ë‹¤.

CGLIBë¥¼ ì‚¬ìš©í•˜ë©´ ì¸í„°í˜ì´ìŠ¤ê°€ ì—†ì–´ë„ êµ¬ì²´ í´ë˜ìŠ¤ë§Œ ê°€ì§€ê³  ë™ì  í”„ë¡ì‹œë¥¼ ë§Œë“¤ì–´ë‚¼ ìˆ˜ ìˆë‹¤.

CGLIBëŠ” ì›ë˜ëŠ” ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ì§€ë§Œ, ìŠ¤í”„ë§ í”„ë ˆì„ì›Œí¬ê°€ ìŠ¤í”„ë§ ë‚´ë¶€ ì†ŒìŠ¤ ì½”ë“œì— í¬í•¨í–ˆë‹¤. ë”°ë¼ì„œ ìŠ¤í”„ë§ì„ ì‚¬ìš©í•œë‹¤ë©´ ë³„ë„ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì¶”ê°€í•˜ì§€ ì•Šì•„ë„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

<br/>

```java
@Slf4j
public class ConcreteService {
	public void call() {
		log.info("ConcreteService í˜¸ì¶œ")
	}
}
```

<br/>

JDK ë™ì  í”„ë¡ì‹œì—ì„œ ì‹¤í–‰ ë¡œì§ì€  Invocationhandlerë¥¼ êµ¬í˜„í•˜ì—¬ ì ìš©í•˜ì˜€ë“¯ì´, CGLIBëŠ” MethodInterceptorë¥¼ ì œê³µí•œë‹¤.

```java
public interface MethodInterceptor extends Callback {
	Object intercept(Object obj, Method method, Object[] args, MethodProxy proxy) throws Throwable;
}
```

- Object obj : CGLIB ê°€ ì ìš©ëœ ê°ì²´
- Method method : í˜¸ì¶œëœ ë©”ì„œë“œ
- Object[] args : ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ë©´ì„œ ì „ë‹¬ëœ ì¸ìˆ˜
- MethodProxy proxy : ë©”ì„œë“œ í˜¸ì¶œì— ì‚¬ìš©

<br/>

```java
public class CustomMethodInterceptor implements MethodInterceptor {
	private final Object target;//í”„ë¡ì‹œë¥¼ ì ìš©í•  ëŒ€ìƒ

	public CustomMethodInterceptor(Object target) {
   	 	this.target = target;
	}

	@Override
	public Object intercept(Object obj, Method method, Object[] args, 	MethodProxy proxy) throws Throwable {
    	System.out.println("ì‹œê°„ ì²´í¬");
    	long start = System.currentTimeMillis();

		Object result = proxy.invoke(target, args);

    	long end = System.currentTimeMillis();
    	long resultTime = end - start;
    	System.out.println("ê±¸ë¦°ì‹œê°„ : "+resultTime);
    	return result;
	}
}
```

<br/>

```java
public class Test {

	@Test
	void cglib() {
		ConcreteService target = new ConcreteService();
		
		Enhancer enhancer = new Enhancer();
		enhancer.setSuperclass(ConcreteService.class);
		enhancer.setCallback(new CustomMethodInterceptor(target));
		ConcreteService proxy = (ConcreteService)enhancer.create();
		
        proxy.call();
	}
}
```

- Enhancer : CGLIBëŠ” Enhancerë¥¼ ì‚¬ìš©í•´ì„œ í”„ë¡ì‹œë¥¼ ìƒì„±í•œë‹¤.
- enhancer.setSuperclass(ConcreteService.class); : CGLIBëŠ” êµ¬ì²´ í´ë˜ìŠ¤ë¥¼ ìƒì† ë°›ì•„ì„œ í”„ë¡ì‹œë¥¼ ìƒì„±í•˜ëŠ”ë°, ì–´ë–¤ í´ë˜ìŠ¤ë¥¼ ìƒì†ë°›ì„ì§€ ì§€ì •í•œë‹¤.
- enhancer.setCallback(new CustomMethodInterceptor(target)); : í”„ë¡ì‹œì— ì ìš©í•  ì‹¤í–‰ ë¡œì§ì„ í• ë‹¹í•œë‹¤.
- enhancer.create(); : í”„ë¡ì‹œë¥¼ ìƒì„±í•œë‹¤.

<br/>

<br/>

### ì œì•½

CGLIBëŠ” í´ë˜ìŠ¤ ê¸°ë°˜ìœ¼ë¡œ ìƒì†ì„ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ëª‡ê°€ì§€ ì œì•½ì´ ìˆë‹¤.

- ë¶€ëª¨ í´ë˜ìŠ¤ì˜ ìƒì„±ìë¥¼ ì²´í¬í•´ì•¼ í•œë‹¤. -> CGLIBëŠ” ìì‹ í´ë˜ìŠ¤ë¥¼ ë™ì ìœ¼ë¡œ ìƒì„±í•˜ê¸° ë•Œë¬¸ì— ê¸°ë³¸ ìƒì„±ìê°€ í•„ìš”í•˜ë‹¤.
- í´ë˜ìŠ¤ì— final í‚¤ì›Œë“œê°€ ë¶™ìœ¼ë©´ ìƒì†ì´ ë¶ˆê°€ëŠ¥í•˜ë‹¤ -> CGLIBì—ì„œ ì˜ˆì™¸ê°€ ë°œìƒí•œë‹¤.
- ë©”ì„œë“œì— final í‚¤ì›Œë“œê°€ ë¶™ìœ¼ë©´ í•´ë‹¹ ë©”ì„œë“œë¥¼ ì˜¤ë²„ë¼ì´ë”© í•  ìˆ˜ ì—†ë‹¤. ->?CGLIBì—ì„œëŠ” í”„ë¡ì‹œ ë¡œì§ì´ ë™ì‘í•˜ì§€ ì•ŠëŠ”ë‹¤.

<br/>

<br/>

### ğŸ“” Reference

##### [ì¸í”„ëŸ° - ìŠ¤í”„ë§ í•µì› ì›ë¦¬ - ê³ ê¸‰í¸](https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81-%ED%95%B5%EC%8B%AC-%EC%9B%90%EB%A6%AC-%EA%B3%A0%EA%B8%89%ED%8E%B8/dashboard)