---
title:  "ìŠ¤í”„ë§ ë°ì´í„° JPA ê³µë¶€í•˜ê¸° -[1]"
excerpt: "ìŠ¤í”„ë§ ë°ì´í„° JPA 1"
date:   2021-10-02 11:09:00 +0900
header:
  teaser: /assets/images/spring.png

categories: javaSpring
tags:
  - Java
  - Spring
last_modified_at: 2021-10-02T11:09:00-05:00


---



<br/>

## <br/>ğŸ’¡ ìŠ¤í”„ë§ ë°ì´í„° JPA

ìŠ¤í”„ë§ ë°ì´í„° JPAë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” 

#### extends JpaRepository<ì—”í‹°í‹° í´ë˜ìŠ¤, PKê°’ì˜ íƒ€ì…>

##### ì„ í•´ì£¼ë©´ ë˜ê³ , ì¸í„°í˜ì´ìŠ¤ë§Œ êµ¬í˜„í•˜ë©´ ë°ì´í„°JPAê°€ ì•Œì•„ì„œ êµ¬í˜„ì²´ë¥¼ ìƒì„±í•˜ì—¬ ì£¼ì…í•´ì¤€ë‹¤.

##### ë˜í•œ ì¸í„°í˜ì´ìŠ¤ì—ëŠ” @Repository ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•˜ì§€ ì•Šì•„ë„ ëœë‹¤.

<br/>

<br/>

```
@EnableJpaRepositories(basePackages = "study.datajpa.repository")
```

@EnableJpaRepositoriesë¥¼ ì‚¬ìš©í•´ ì£¼ì–´ì•¼ í•˜ë‚˜ ìŠ¤í”„ë§ ë¶€íŠ¸ë¥¼ ì‚¬ìš©í•˜ë©´, ì•Œì•„ì„œ í•´ì£¼ê¸° ë•Œë¬¸ì—, íŒ¨í‚¤ì§€ ìœ„ì¹˜ê°€ @SpringBootApplicationì˜ íŒ¨í‚¤ì§€ ë²”ìœ„ë¥¼ ë²—ì–´ë‚˜ì§€ ì•ŠëŠ”ë‹¤ë©´, ë”°ë¡œ ì„¤ì •í•´ ì¤„ í•„ìš”ê°€ ì—†ë‹¤.

<br/>

<br/>

## ğŸ’¡ ì¿¼ë¦¬ ë©”ì†Œë“œ ê¸°ëŠ¥

- #### ë©”ì†Œë“œ ì´ë¦„ìœ¼ë¡œ ì¿¼ë¦¬ ìƒì„±

- #### ë©”ì†Œë“œ ì´ë¦„ìœ¼ë¡œ JPA NameQuery í˜¸ì¶œ

- #### @Query ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•´ì„œ ë¦¬íŒŒì§€í† ë¦¬ ì¸í„°í˜ì´ìŠ¤ì— ì¿¼ë¦¬ ì§ì ‘ ì •ì˜

<br/>

### âœ  ë©”ì†Œë“œ ì´ë¦„ìœ¼ë¡œ ì¿¼ë¦¬ ìƒì„±

findByUsernameAndAgeGreaterThan

<script src="https://gist.github.com/ShinDongHun1/d27fbbeb9fedb578d2eeb3cff3505788.js"></script>

ë‹¤ìŒê³¼ ê°™ì€ ì¿¼ë¦¬ë¥¼ ì•Œì•„ì„œ ë§Œë“¤ì–´ì¤€ë‹¤

<br/>

| Keyword                | Sample                                                       | JPQL snippet                                                 |
| :--------------------- | :----------------------------------------------------------- | :----------------------------------------------------------- |
| `Distinct`             | `findDistinctByLastnameAndFirstname`                         | `select distinct â€¦ where x.lastname = ?1 and x.firstname = ?2` |
| `And`                  | `findByLastnameAndFirstname`                                 | `â€¦ where x.lastname = ?1 and x.firstname = ?2`               |
| `Or`                   | `findByLastnameOrFirstname`                                  | `â€¦ where x.lastname = ?1 or x.firstname = ?2`                |
| `Is`, `Equals`         | `findByFirstname`,`findByFirstnameIs`,`findByFirstnameEquals` | `â€¦ where x.firstname = ?1`                                   |
| `Between`              | `findByStartDateBetween`                                     | `â€¦ where x.startDate between ?1 and ?2`                      |
| `LessThan`             | `findByAgeLessThan`                                          | `â€¦ where x.age < ?1`                                         |
| `LessThanEqual`        | `findByAgeLessThanEqual`                                     | `â€¦ where x.age <= ?1`                                        |
| `GreaterThan`          | `findByAgeGreaterThan`                                       | `â€¦ where x.age > ?1`                                         |
| `GreaterThanEqual`     | `findByAgeGreaterThanEqual`                                  | `â€¦ where x.age >= ?1`                                        |
| `After`                | `findByStartDateAfter`                                       | `â€¦ where x.startDate > ?1`                                   |
| `Before`               | `findByStartDateBefore`                                      | `â€¦ where x.startDate < ?1`                                   |
| `IsNull`, `Null`       | `findByAge(Is)Null`                                          | `â€¦ where x.age is null`                                      |
| `IsNotNull`, `NotNull` | `findByAge(Is)NotNull`                                       | `â€¦ where x.age not null`                                     |
| `Like`                 | `findByFirstnameLike`                                        | `â€¦ where x.firstname like ?1`                                |
| `NotLike`              | `findByFirstnameNotLike`                                     | `â€¦ where x.firstname not like ?1`                            |
| `StartingWith`         | `findByFirstnameStartingWith`                                | `â€¦ where x.firstname like ?1` (parameter bound with appended `%`) |
| `EndingWith`           | `findByFirstnameEndingWith`                                  | `â€¦ where x.firstname like ?1` (parameter bound with prepended `%`) |
| `Containing`           | `findByFirstnameContaining`                                  | `â€¦ where x.firstname like ?1` (parameter bound wrapped in `%`) |
| `OrderBy`              | `findByAgeOrderByLastnameDesc`                               | `â€¦ where x.age = ?1 order by x.lastname desc`                |
| `Not`                  | `findByLastnameNot`                                          | `â€¦ where x.lastname <> ?1`                                   |
| `In`                   | `findByAgeIn(Collection<Age> ages)`                          | `â€¦ where x.age in ?1`                                        |
| `NotIn`                | `findByAgeNotIn(Collection<Age> ages)`                       | `â€¦ where x.age not in ?1`                                    |
| `True`                 | `findByActiveTrue()`                                         | `â€¦ where x.active = true`                                    |
| `False`                | `findByActiveFalse()`                                        | `â€¦ where x.active = false`                                   |
| `IgnoreCase`           | `findByFirstnameIgnoreCase`                                  | `â€¦ where UPPER(x.firstname) = UPPER(?1)`                     |

[ìŠ¤í”„ë§ ë°ì´í„° JPA ê³µì‹ ë¬¸ì„œë¥¼ ì°¸ì¡°í•˜ì](https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.query-methods.query-creation)

<br/>

<script src="https://gist.github.com/ShinDongHun1/0bae148549ba38eb505172aef650a71f.js"></script>

ìœ„ì²˜ëŸ¼ ìˆœì„œê°€ ë°”ë€Œì–´ë„ ìƒê´€ì—†ìœ¼ë‚˜, ë§¤ê°œë³€ìˆ˜ì˜ ìˆœì„œë¥¼ ë°”ì¸ë”©ë˜ëŠ” ìˆœì„œì— ë§ê²Œ ë°”ê¿”ì£¼ì–´ì•¼ í•œë‹¤.

<br/>

#### ì¡°íšŒ: find...By, read...By, get...By

- findMemberByì²˜ëŸ¼ ...ì— ì‹ë³„í•˜ê¸° ìœ„í•œ ë‚´ìš©(ì„¤ëª…)ì´ ë“¤ì–´ê°€ê¸°ë„ í•˜ëŠ”ë°, ì½”ë“œì— ì˜í–¥ì„ ì£¼ëŠ”ê²ƒì€ ì•„ë‹ˆë‹¤.

#### Count: count...By : ë°˜í™˜íƒ€ì… long

#### Exists: exists...By : ë°˜í™˜íƒ€ì… boolean

#### ì‚­ì œ: delete...By, remove...By : ë°˜í™˜íƒ€ì… long

#### DISTINCT: findDistinct, findMemberDistinctBy

#### LIMIt : findFirst3, findFirst, findTop, findTop3

- ##### [ìŠ¤í”„ë§ ë°ì´í„° JPA ê³µì‹ ë¬¸ì„œë¥¼ ì°¸ì¡°í•˜ì](https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.limit-query-result)

<br/>

<br/>

#### âœë©”ì†Œë“œ ì´ë¦„ìœ¼ë¡œ JPA NameQuery í˜¸ì¶œ

##### (ê±°ì˜ ì“¸ ì¼ì´ ì—†ë‹¤ë‹ˆê¹Œ ëŒ€ì¶© ë„˜ì–´ê°€ì)

<script src="https://gist.github.com/ShinDongHun1/33d447254e08adee8d89f7c765767c6a.js"></script>

##### em.createNamedQuery("User.findByEmailAddress",User.class).setParameter("emailAddress", emailAddress); ì´ë ‡ê²Œ ì‚¬ìš©í•˜ë©´ ëœë‹¤

ë˜í•œ 

<script src="https://gist.github.com/ShinDongHun1/abe4f5722509d1e62d979eef46ef8183.js"></script>

@Query(name = "User.findByEmailAddress") ë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ë„ ìˆë‹¤.

##### ë‹¨, ì´ë•ŒëŠ” @Paramì„ ì ì–´ì£¼ì–´ì•¼ í•œë‹¤.

<br/>

<br/>

### âœ @Query ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•´ì„œ ë¦¬íŒŒì§€í† ë¦¬ ì¸í„°í˜ì´ìŠ¤ì— ì¿¼ë¦¬ ì§ì ‘ ì •ì˜

<script src="https://gist.github.com/ShinDongHun1/79c25d72e0c9349b673b3cd099de815c.js"></script>

<br/>

ì°¸ê³ ë¡œ ë™ì  ì¿¼ë¦¬ëŠ” ê·¸ëƒ¥ QueryDSL ì¨ë¼... ë°©ë²•ì´ ì—†ë‹¤..ã…

<br/>

#### @Queryë¡œ ê°’, DTO ì¡°íšŒí•˜ê¸°!

<script src="https://gist.github.com/ShinDongHun1/4ead7c15b4245bbdf7b80f25b50e1e02.js"></script>
ê°’ ì¡°íšŒí•˜ê¸°
<br/>

<script src="https://gist.github.com/ShinDongHun1/bb89d1643029c16f82d476ae00b03891.js"></script>

DTO ì¡°íšŒí•˜ê¸°

<br/>

<br/>

<br/>

### ğŸ’¡ íŒŒë¼ë¯¸í„° ë°”ì¸ë”©

ì´ë¦„ ê¸°ë°˜ê³¼ ìœ„ì¹˜ ê¸°ë°˜ì´ ìˆëŠ”ë°, ì´ë¦„ ê¸°ë°˜ì˜ íŒŒë¼ë¯¸í„° ë°”ì¸ë”©ì„ í•˜ì(ìœ„ì¹˜ëŠ” ìˆœì„œê°€ ë°”ë€Œë©´ ì˜¤ë¥˜ë‚¨)

<script src="https://gist.github.com/ShinDongHun1/71c17673da210ee499743184e2c44535.js"></script>

<br/>

### ğŸ’¡ ì»¬ë ‰ì…˜ íŒŒë¼ë¯¸í„° ë°”ì¸ë”©

Collection íƒ€ì…ìœ¼ë¡œ inì ˆ ì§€ì›
<script src="https://gist.github.com/ShinDongHun1/877cf0d083b96e1d0ab34e756b34ee29.js"></script>

<br/>

### ğŸ’¡ ë°˜í™˜ íƒ€ì…

<script src="https://gist.github.com/ShinDongHun1/8932553adf40ad835099ad8def7abb11.js"></script>

#### ì¡°íšŒ ê²°ê³¼ê°€ ë§ê±°ë‚˜ ì—†ìœ¼ë©´?

#### ì»¬ë ‰ì…˜

- ##### ê²°ê³¼ ì—†ìŒ: ë¹ˆ ì»¬ë ‰ì…˜ ë°˜í™˜

#### ë‹¨ê±´ ì¡°íšŒ

- ##### ê²°ê³¼ ì—†ìŒ: null ë°˜í™˜

- ##### ê²°ê³¼ê°€ 2ê±´ ì´ìƒ: javax.persistence.NonUniqueResultException ì˜ˆì™¸ ë°œìƒ

##### ì°¸ê³ ë¡œ Optionalì´ ë¹„ì–´ìˆì„ ë•Œ get í•˜ë©´ ì˜¤ë¥˜ê°€ ë‚©ë‹ˆë‹¹. orElse()ë“±ì„ ì‚¬ìš©í•´ì•¼ í•¨

[JPA ê³µì‹ ë¬¸ì„œ](https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#appendix.query.return.types)

<br/>

<br/>

## ğŸ’¡ í˜ì´ì§•ê³¼ ì •ë ¬ íŒŒë¼ë¯¸í„°

- #### org.springframework.data.domain.Sort : ì •ë ¬ ê¸°ëŠ¥

- #### org.springframework.data.domain.Pageable : í˜ì´ì§• ê¸°ëŠ¥ (ë‚´ë¶€ì— Sort í¬í•¨)

<br/>

### íŠ¹ë³„í•œ ë°˜í™˜ íƒ€ì…

- ##### org.springframework.data.domain.Page : ì¶”ê°€ count ì¿¼ë¦¬ ê²°ê³¼ë¥¼ í¬í•¨í•˜ëŠ” í˜ì´ì§•(totalCount í™•ì¸ ê°€ëŠ¥)

- ##### org.springframework.data.domain.Slice : ì¶”ê°€ count ì¿¼ë¦¬ ì—†ì´ ë‹¤ìŒ í˜ì´ì§€ë§Œ í™•ì¸ ê°€ëŠ¥(ë‚´ë¶€ì ìœ¼ë¡œ limit + 1ì¡°íšŒ)

- ##### List (ìë°” ì»¬ë ‰ì…˜): ì¶”ê°€ count ì¿¼ë¦¬ ì—†ì´ ê²°ê³¼ë§Œ ë°˜í™˜

<br/>

### ì‚¬ìš©ì˜ˆì‹œ

<script src="https://gist.github.com/ShinDongHun1/2dee670246c8b73ac5dc2fef3be738b8.js"></script>

<br/>

<script src="https://gist.github.com/ShinDongHun1/72b05de62cbb0062016a5b2c788d58e7.js"></script>

```
PageRequest.of(page, size, Sort.by(Sort.Direction.DESC, "username"));
```

ì—ì„œ page, size ì€ pageë²ˆì§¸ í˜ì´ì§€ì™€, sizeê°œì”© í™”ë©´ì— ì¶œë ¥í•œë‹¤ëŠ” ì˜ë¯¸ì´ë‹¤.

ìœ„ì˜ ì½”ë“œì—ì„œëŠ” 3ê°œì”© í™”ë©´ì— ì¶œë ¥í•  ë•Œ, 2ë²ˆì§¸ í˜ì´ì§€ë¥¼ ì¡°íšŒí•œë‹¤ëŠ” ëœ»

##### Pageable ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œë–„ëŠ” PageRequestë¥¼ ë§ì´ ì‚¬ìš©í•œë‹¤

(ì°¸ê³ ë¡œ pageëŠ” 0page ë¶€í„° ì‹œì‘ì´ë‹¤!)

<br/>

<br/>

## ğŸ’¡êµ¬í•´ì˜¨ Memberë¥¼ DTOë¡œ ë³€í™˜í•˜ê¸°

```java
Page<Member> page = memberRepository.findByAge(age, pageRequest);
```

ë‹¤ìŒê³¼ ê°™ì€ ì½”ë“œë¥¼ ë³´ì

```java
page.map(member -> new MemberDto(member.getId(), member.getUsername(), member.getTeam()));
```

ìš”ëŸ° ì‹ìœ¼ë¡œ mapì„ ì´ìš©í•˜ì—¬ ë°”ê¿”ì¤„ ìˆ˜ ìˆë‹¤.

(ì°¸ê³ ë¡œ teamì„ ê°€ì ¸ì™€ì„œ getTeam().getName()ì´ëŸ°ì‹ìœ¼ë¡œ ì‚¬ìš©í•  ê²ƒì´ë¼ë©´ fetch Joinì„ ì¨ë¼! ì•ˆê·¸ëŸ¬ë©´ ì¿¼ë¦¬ í•œë²ˆ ë” ë‚˜ê°€ì„œ ì„±ëŠ¥ ë–¨ì–´ì§„ë‹¤!)

<br/>

<br/>

## ğŸ’¡ count ì¿¼ë¦¬ì˜ ë¶„ë¦¬

ë°˜í™˜ íƒ€ì…ì´ Pageì¼ ê²½ìš°, totalCountë¥¼ êµ¬í•˜ëŠ” ì¿¼ë¦¬ëŠ”, í”„ë¡œì ì…˜ í•˜ëŠ” ì¿¼ë¦¬ë¥¼ ë”°ë¼ê°„ë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, selectë¡œ memberë¥¼ êµ¬í•´ì˜¬ ë•Œ teamì„ joiní•´ì„œ ê°€ì ¸ì˜¨ë‹¤ë©´, totalCountë¥¼ êµ¬í•  ë•Œì—ë„ joinì„ í•œë‹¤ëŠ” ì†Œë¦¬ì´ë‹¤. 

#### ë”°ë¼ì„œ left outer joinìœ¼ë¡œ ë°ì´í„°ë¥¼ êµ¬í•˜ëŠ” ì¿¼ë¦¬ë¥¼ ì‚¬ìš©í•˜ë©´, countQueryëŠ” ë”°ë¡œ left outer joinì„ í•´ì£¼ì§€ ì•Šì•„ë„ ë°ì´í„°ì˜ ê°œìˆ˜ê°€ ë˜‘ê°™ë‹¤. 

#### ë”°ë¼ì„œ ì´ë•ŒëŠ” countQueryë¥¼ ë¶„ë¦¬í•˜ì—¬ joinì„ ì‚¬ìš©í•˜ì§€ ì•Šë„ë¡ í•´ì•¼ ì„±ëŠ¥ì´ ì¢‹ì•„ì§„ë‹¤.

ì•„ë˜ ì˜ˆì‹œë¥¼ ë³´ê³  ì´í•´í•´ë³´ì.

<script src="https://gist.github.com/ShinDongHun1/cdc9b4b0a8e1eeacd06b585dbda0d66f.js"></script>

##### ë§Œì•½ ì € ì¿¼ë¦¬ì—ì„œ countQueryë¥¼ ì§€ìš°ê³  valueì— ìˆëŠ” teamì„ join í•˜ëŠ” ì¿¼ë¦¬ë§Œ ì‹¤í–‰í•œë‹¤ í•´ë³´ì. ê²°ê³¼ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

![image-20211002152249513](https://raw.githubusercontent.com/ShinDongHun1/image_repo/main/img/image-20211002152249513.png)

##### ì´ë ‡ê²Œ ì²˜ìŒ select ë¬¸ì—ì„œ joinì´ 1ë²ˆ, total countë¥¼ êµ¬í•˜ëŠ” ì¿¼ë¦¬ì—ì„œ ë˜ joinì´ 1ë²ˆ ì‹¤í–‰ë˜ì–´ë²„ë¦°ë‹¤.

##### ì¼ë°˜ joinì€ left outer joinì´ë¯€ë¡œ, rowì˜ ìˆ˜ê°€ ë³€í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ, totalcountë¥¼ êµ¬í•  ë•Œì—ëŠ” í•´ì¤„ í•„ìš”ê°€ ì—†ëŠ”ë°, JPAëŠ” ë©ì²­í•´ì„œ í•˜ë‚˜ë³´ë‹¤. ê·¸ëŸ¬ë‹ˆê¹Œ countQueryë¥¼ ë”°ë¡œ ë¶„ë¦¬í•´ì£¼ì.

<br/>

##### ê·¸ëŸ¬ë©´ ì´ë ‡ê²Œ ëœë‹¤.

![image-20211002152553387](https://raw.githubusercontent.com/ShinDongHun1/image_repo/main/img/image-20211002152553387.png)

##### (ì°¸ê³ ë¡œ left outer join ì´ ì•„ë‹ˆë¼ inner joinì„ ì‚¬ìš©í•˜ëŠ” ìƒíƒœì—ì„œ countQueryë¥¼ ì¬ëŒ€ë¡œ ì •ì˜í•´ì£¼ì§€ ì•Šìœ¼ë©´, totalCountë¥¼ êµ¬í•  ë•Œì—ë„ inner Joinìœ¼ë¡œ ì¿¼ë¦¬ë¥¼ ìˆ˜í–‰í•˜ë¯€ë¡œ, ê²°ê³¼ê°€ ì´ìƒí•´ì§ˆ ìˆ˜ ìˆë‹¤.!)
