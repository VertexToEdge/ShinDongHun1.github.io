---
title:  "스프링 MVC 공부하기[5]"
excerpt: "스프링 MVC 기능, 헤더 조회, 요청 파라미터"
date:   2021-10-13 19:30:00
header:
  teaser: /assets/images/spring.png

categories: MVC
tags:
  - Java
  - Spring
  - MVC
last_modified_at: 2021-10-19T17:30:00

---

<br/>

[스프링 MVC 1편](https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81-mvc-1/dashboard)를 보고 공부하고 정리한 내용을 올립니다

<br/>

## 💡 스프링 MVC 기능

### ✏️ @RestController

- ##### @Controller : 반환 값이 String 이면 뷰 이름으로 인식된다. 그래서 '뷰를 찾고 뷰가 렌더링' 된다

- ##### @RestController : 반환 값으로 뷰를 찾는 것이 아니라, HTTP 메시지 바디에 바로 입력한다.

- ##### @RestController = @Controller + @ResponseBody

<br/>

### ✏️ @RequestMapping("/hello-basic")

- ##### /hello-baisc : URL 호출이 오면 이 메서드가 실행되도록 매핑한다.

- ##### 대부분의 속성을 배열로 제공하므로 다중 설정이 가능하다. {"/hello", "/member"} 

- ##### @RequestMapping 에 method 속성으로 HTTP 메서드를 지정할 수 있다.

  - 축약 가능
  - @GetMapping , @PostMapping , @PutMapping , @DeleteMapping , @PatchMapping

<br/>

<br/>

### ✏️PathVariable(경로 변수) 사용

<script src="https://gist.github.com/ShinDongHun1/49f6477afc7af5fa0d5691a874620467.js"></script>

최근 HTTP API는 다음과 같이 리소스 경로에 식별자를 넣는 스타일을 선호한다.

- /mapping/userA
- /users/1

- ##### @RequestMapping 은 URL 경로를 템플릿화 할 수 있는데, @PathVariable을 사용하면 매칭되는 부분을 편리하게 조회할 수 있다.

- ##### @PathVariable의 이름과 파라미터 이름이 같으면 생략할 수 있다.

  - 위의 예시에서는 data 대신 userId를 사용하면, ("userId") 생략이 가능하다

<br/>

#### 다중 사용

<script src="https://gist.github.com/ShinDongHun1/3b7dac34a3768f0c134c0512276c1182.js"></script>

<br/>

##### 특정 파라미터가 있거나 없는 조건을 추가 가능

파라미터로 추가 매핑 

- params="mode", 
- params="!mode" 
- params="mode=debug" 
- params="mode!=debug"
- params = {"mode=debug","data=good"} 

<script src="https://gist.github.com/ShinDongHun1/508e648e54c0727a1411c78739e8ed9f.js"></script>

<br/>

##### 미디어 타입 조건 매핑 - HTTP 요청 Content-Type, consume

<script src="https://gist.github.com/ShinDongHun1/073f5ddeff78879fb61ce05a5a4219da.js"></script>

##### application/json 의 데이터만 받을 수 있음. 다른 형식이 오면 오류

<br/>

##### 미디어 타입 조건 매핑 - HTTP 요청 Accept, produce

<script src="https://gist.github.com/ShinDongHun1/460a77ef67459bf7120aa596717bd85d.js"></script>

요청의 Accept가 text/html 데이터를 받을 수 있어야 함. 그렇지 않으면 오류

<br/>

<br/>

### 💡 HTTP 요청 - 기본, 헤더 조회

<script src="https://gist.github.com/ShinDongHun1/3c9be30f16e5bdfe948bfc83946a10c1.js"></script>

- HttpMethod : HTTP 메서드를 조회한다.
- Locale : Locale 정보를 조회한다.
-  @RequestHeader MultiValueMap<String, String> headerMap : 모든 HTTP 헤더를 MultiValueMap 형식으로 조회한다.
- @RequestHeader("host") : String host 특정 HTTP 헤더를 조회한다. 
  - 속성 필수 값 여부: required
  - 기본 값 속성: defaultValue
- @CookieValue(value = "myCookie", required = false) String cookie :  특정 쿠키를 조회한다.
  - 속성 필수 값 여부: required
  - 기본 값 속성: defaultValue

##### 참고 MultiValueMap

- MAP과 유사한데, 하나의 키에 여러 값을 받을 수 있다.
- HTTP header, HTTP 쿼리 파라미터와 같이 하나의 키에 여러 값을 받을 때 사용한다.

<br/>

##### 참고 

##### @Conroller 의 사용 가능한 파라미터 목록은 다음 공식 메뉴얼에서 확인할 수 있다.

> [https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc-annarguments](https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc-annarguments) 

<br/>

#####  참고 

##### @Conroller 의 사용 가능한 응답 값 목록은 다음 공식 메뉴얼에서 확인할 수 있다. 

> [https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc-annreturn-types](https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc-annreturn-types)

<br/>

<br/>

## 💡 HTTP 요청 파라미터 조회

<br/>

### **💡 **쿼리 파라미터, HTML Form 조회

#### GET , 쿼리 파라미터 전송

예시 : http://localhost:8080/request-param?username=hello&age=20

<br/>

#### POST, HTML Form 전송

예시

> POST /request-param ...
>
> content-type: application/x-www-form-urlencoded 
>
> 
>
> username=hello&age=20

<br/>

##### GET 쿼리 파리미터 전송 방식이든, POST HTML Form 전송 방식이든 둘다 형식이 같으므로 구분없이 조회할 수 있다. 

##### 이것을 간단히 요청 파라미터(request parameter) 조회라 한다

<br/>

참고로 HttpServletRequest의 getParameter를 사용하여 조회할 수 있으나, 그건 전에 했었기 때문에 넘어가겠다.

<br/>

### ✏️ HTTP 요청 파라미터 조회 - @RequestParam

<script src="https://gist.github.com/ShinDongHun1/442526edb45d5ce92c80c891b2b7953a.js"></script>

위와 같이 사용할 수 있고, 

- ##### @RequestParam의 name(value) 속성이 파라미터 이름으로 사용

- ##### HTTP 파라미터 이름이 변수 이름과 같으면 @RequestParam(name="xx") 생략 가능

- ##### String , int , Integer 등의 단순 타입이면 @RequestParam 도 생략 가능

<br/>

다음과 같이 사용할 수 있다.

<script src="https://gist.github.com/ShinDongHun1/b69c85af9c338a7793173064b3195ef7.js"></script>

#####  주의  

- ##### @RequestParam 애노테이션을 생략하면 스프링 MVC는 내부에서 @RequestParam의  required속성을 false로 적용한다. 

- username=   :이렇게 쓴다면 null이 아니라 빈문자("")로 인식한다.

- required 속성을 true로 설정한 후 defaultValue를 설정하면, 파라미터 값이 없어도 오류가 발생하지 않고 defaultValue값이 들어간다.

- defaultValue 를 설정하면, 빈문자의 경우(username= )의 경우에도 defaultValue값이 설정된다.

<br/>

#### 파라미터를 Map으로 조회하기 - requestParamMap

<script src="https://gist.github.com/ShinDongHun1/6e7b99071cf3482ade361a3219d3730f.js"></script>

파라미터를 Map , MultiValueMap으로 조회할 수 있다.

- 파라미터의 값이 1개가 확실하다면 Map을 사용해도 되지만 그렇지 않다면 MultiValueMap을 사용하자.

<br/>

<br/>

### ✏️ HTTP 요청 파라미터 조회 - @ModelAttribute

보통 개발을 하면 요청 파라미터를 받아서 필요한 객체를 만들고, 그 객체에 값을 넣어주는데

이 과정을 자동화해주는 @ModelAttribute란 기능을 제공한다.

<br/>

##### 우선 요청 파라미터를 바인딩 받을 객체를 만들자.

<script src="https://gist.github.com/ShinDongHun1/fe55ad3446b8729a0eaa458a27d2d4ba.js"></script>

- @Data는 롬복을 사용한 것이다.

<br/>

<script src="https://gist.github.com/ShinDongHun1/442bbf368a5a9fce16e19a7506ae1628.js"></script>

스프링MVC는 @ModelAttribute 가 있으면 다음을 실행한다

- HelloData 객체를 생성한다. 
- 요청 파라미터의 이름으로 HelloData 객체의 프로퍼티를 찾는다. 그리고 해당 프로퍼티의 setter를 호출해서 파라미터의 값을 입력(바인딩) 한다. 
- 예) 파라미터 이름이 username 이면 setUsername() 메서드를 찾아서 호출하면서 값을 입력한다
  - setter가 없으면 null값이 들어온다.

<br/>

#### @ModelAttribute 는 생략할 수 있다. 

##### 그런데 @RequestParam 도 생략할 수 있으니 혼란이 발생할 수 있다.

##### 스프링은 해당 생략시 다음과 같은 규칙을 적용한다. 

- String , int , Integer 같은 단순 타입 = @RequestParam 
- 나머지 = @ModelAttribute (argument resolver 로 지정해둔 타입 외)

<br/>

##### 프로퍼티

- 객체에 getUsername() , setUsername() 메서드가 있으면, 이 객체는 username 이라는 프로퍼티를 가지고 있다. 
- username 프로퍼티의 값을 변경하면 setUsername() 이 호출되고, 조회하면 getUsername() 이 호출된다

<br/>

##### 바인딩 오류

-  age=abc 처럼 숫자가 들어가야 할 곳에 문자를 넣으면 BindException 이 발생한다. 이런 바인딩 오류를 처리하는 방법은 검증 부분에서 다룬다

<br/>

<br/>

## 🧾 정리

#### ✏️ @RestController : 반환 값으로 뷰를 찾는 것이 아니라, HTTP 메시지 바디에 바로 입력한다.

#### ✏️ @RequestMapping("/hello-basic") : URL 호출이 오면 이 메서드가 실행되도록 매핑한다.

#### ✏️ HTTP 요청 - 기본, 헤더 조회

- HttpMethod : HTTP 메서드를 조회한다.
- Locale : Locale 정보를 조회한다.
-  @RequestHeader MultiValueMap<String, String> headerMap : 모든 HTTP 헤더를 MultiValueMap 형식으로 조회한다.
- @RequestHeader("host") : String host 특정 HTTP 헤더를 조회한다. 
  - 속성 필수 값 여부: required
  - 기본 값 속성: defaultValue
- @CookieValue(value = "myCookie", required = false) String cookie :  특정 쿠키를 조회한다.
  - 속성 필수 값 여부: required
  - 기본 값 속성: defaultValue



#### ✏️  쿼리 파라미터, HTML Form 조회

- #####  @RequestParam : 요청 파라미터의 값을 가져온다.

- ##### @ModelAttribute : 요청 파라미터의 값을 객체에 바인딩.
