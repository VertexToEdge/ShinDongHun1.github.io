---
title:  "Spring 공부하기 - 실습 [2]"
excerpt: "AppConfig를 스프링으로 전환하기, 컴포넌트 스캔 사용"
date:   2021-10-09 20:33:00 +0900
header:
  teaser: /assets/images/spring.png

categories: javaSpring
tags:
  - Java
  - Spring
last_modified_at: 2021-10-09T20:33:00-05:00



---

<br/>

<br/>

[스프링 핵심 원리 기본편](https://www.inflearn.com/course/스프링-핵심-원리-기본편)를 보고 대부분 공부하고 정리한 내용을 올립니다

<br/>

<br/>

#### AppConfig를 스프링을 사용하여 변경하기

<script src="https://gist.github.com/ShinDongHun1/094daf07381198b26aa0eb0915fb5715.js"></script>

@Configuration : 구성 정보라는것을 표시

@Bean: 스프링 컨테이너에 등록됨

<br/>

사용은 

```java
ApplicationContext ac  = new AnnotationConfigApplicationContext(AppConfig.class);

MemberService memberService = ac.getBean("memberService", MemberService.class);
```

#### 스프링 컨테이너

- ApplicationContext를 스프링 컨테이너라 한다.
- 기존에는 우리가  직접 AppConfig를 사용하였지만, 이제부터는 스프링 컨테이너를 통해서 사용한다.
- 스프링 컨테이너는 @Configuration이 붙은 AppConfig를 설정정보로 사용한다. 여기서 @Bean이라 적힌 메서드를 모두 호출해서 반환한 객체를 스프링 컨테이너에 등록한다. 이렇게 스프링 컨테이너에 등록된 객체를 스프링 빈이라 한다.

<br/>

<br/>

### 💡 컴포넌트 스캔 사용하기

<br/>

#### AppConfig 바꾸기

<script src="https://gist.github.com/ShinDongHun1/1ecc5a5a36d489686182a9bc1dd1fa4e.js"></script>

<br/>

#### 💻MemoryMemberRepository .java

<script src="https://gist.github.com/ShinDongHun1/8f0edeadc28e488a20604fc5e2aa0f79.js"></script>

이런식으로 FixDiscountPolicy와 RateDiscountPolicy에도 설정해주자.

<br/>

#### 💻MemberServiceImpl.java

<script src="https://gist.github.com/ShinDongHun1/a1318c0ba36166157cfe06482ce03a1b.js"></script>

@Autowired를 통해 자동으로 의존관계가 주입된다.

<br/>

#### 💻OrderServiceImpl.java

<script src="https://gist.github.com/ShinDongHun1/b716f178e6ae99ed4cbbf6e120e3a83b.js"></script>

<br/>

#### 사용

```java
ApplicationContext ac  = new AnnotationConfigApplicationContext(AppConfig.class);
MemberService memberService = ac.getBean("memberService", MemberService.class);
```

<br/>

<br/>

### 💡Filter 사용하기

#### MyIncludeComponent 

<script src="https://gist.github.com/ShinDongHun1/d6d884adbfbf815f0ae8ad158d4c146b.js"></script>

#### BeanA

<br/>

<script src="https://gist.github.com/ShinDongHun1/d5d60ccb92934b5a8445c46d0ab35bec.js"></script>

다음과 같이 내가 만든 어노테이션을 적용한 후

<br/>

<script src="https://gist.github.com/ShinDongHun1/06ada20bedd48fbf77d628d5c65bd8a8.js"></script>

컴포넌트 스캔에 includeFilters 속성에 다음과 같이 설정해주면 된다.

참고로 제외하려면 excludeFilters 속성에 추가해주면 된다.

<br/>

<br/>

### 💡옵션 처리

<script src="https://gist.github.com/ShinDongHun1/d055c98862222543e347ae2d933252e3.js"></script>

- @Autowired(required=false) : 자동 주입할 대상이 없으면 수정자 메서드 자체가 호출 안됨 
- org.springframework.lang.@Nullable : 자동 주입할 대상이 없으면 null이 입력된다. 
- Optional<> : 자동 주입할 대상이 없으면 Optional.empty 가 입력된다.

#### 참고로

> static inner class로 TestBean을 사용했는데요. static 키워드를 빼면 예외가 발생합니다. 내용을 보니 TestBean.class를 인자로 받아 스프링 컨테이너를 생성하고 인자로 받은 클래스를 빈으로 등록(생성)하는 과정에서 문제가 생기는 걸로 보입니다.
>
> 
>
> 이 상황을 TestBean을 생성하려면 외부클래스(AutowiredTest)의 인스턴스가 필요한데 컨테이너에서 관리하는 정보에 없어서(AutowiredTest가 빈으로 등록되지 않아서) 외부클래스의 인스턴스를 생성할 수가 없고 그로 인해 static이 아닌 내부클래스를 생성(빈으로 등록)하지 못해 발생한 예외라 이해하면 될까요..?
>
> static이 붙었을 때는 TestBean을 컨테이너에 등록( 내부적으로 생성자 호출)할 때 외부클래스의 인스턴스 유무는 상관이 없기 때문에 문제없이 동작한다고 이해했고요.
>
> 
>
> 몇 강 전부터 궁금했는데 이제야 질문드립니다. 제가 이해한 내용이 맞을까요? 혹시 잘못 이해한 부분이 있는지 궁금합니다^^
>
> 강의는 정말 재미있게 잘 보고있습니다! 감사합니다^^*

#### 답변

> 안녕하세요. geunhyeong0421님
>
> 생각하신 부분이 맞습니다. 그런데 추가로 외부 클래스를 스프링 빈으로 등록해도 내부 클래스를 스프링 빈으로 등록할 수 는 없을거에요. 왜냐하면 스프링은 등록된 외부 클래스 정보와 무관하게 내부 클래스에 바로 접근해서 등록하려도 시도할거에요.
>
> 자바 언어 문법상 문제를 해결하려면 다음과 같이 하시면 되지만 static을 사용하시는 것을 권장합니다.
>
> ```java
> @Bean
> public ClassOut.ClassInner classInner() {
>     ClassOut classOut = new ClassOut();
>     return classOut.new ClassInner();
> }
> ```
>
> 감사합니다.

##### 선생님 최고..!!!!!
