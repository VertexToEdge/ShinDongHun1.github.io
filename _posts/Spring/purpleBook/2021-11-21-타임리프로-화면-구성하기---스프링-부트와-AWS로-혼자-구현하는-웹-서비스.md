---
title:  "íƒ€ì„ë¦¬í”„ë¡œ í™”ë©´ êµ¬ì„±í•˜ê¸° - ìŠ¤í”„ë§ ë¶€íŠ¸ì™€ AWSë¡œ í˜¼ì êµ¬í˜„í•˜ëŠ” ì›¹ ì„œë¹„ìŠ¤"
excerpt: "ìŠ¤í”„ë§ ë¶€íŠ¸ì™€ AWSë¡œ í˜¼ì êµ¬í˜„í•˜ëŠ” ì›¹ ì„œë¹„ìŠ¤ 3"
date:   2021-11-21 01:16:00 
header:
  teaser: /assets/images/spring.png

categories: purpleBook
tags:
  - Java
  - Spring
last_modified_at: 2021-11-21T01:16:00






---

<br/>

<br/>

## ì‹œì‘ì— ì•ì„œ

ì±…ì—ì„œëŠ” íƒ€ì„ë¦¬í”„ê°€ ì•„ë‹Œ ë¨¸ìŠ¤í…Œì¹˜ë¡œ í™”ë©´ì„ êµ¬ì„±í•˜ì˜€ë‹¤. ì´ ì±…ì€ ì •ë§ ìŠ¤í”„ë§ì„ ê°“ ì‹œì‘í•œ ì‚¬ëŒë“¤ì„ ìœ„í•´ì„œ ì“´ ì±…ì¸ ê²ƒ ê°™ê³ , ë˜í•œ íƒ€ì„ë¦¬í”„ ëŒ€ì‹  ë¨¸ìŠ¤í…Œì¹˜ë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ ë¡œ íƒ€ì„ë¦¬í”„ê°€ ì–´ë µê¸°ì— ë¨¸ìŠ¤í…Œì¹˜ë¥¼ ì‚¬ìš©í•œë‹¤ í•˜ì˜€ë‹¤. 

ê·¸ëŸ¬ë‚˜ ë‚˜ëŠ” ê·¸ëƒ¥ ë¯¸ë˜ë¥¼ ë³¸ë‹¤ë©´ íƒ€ì„ë¦¬í”„ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ë§ë‹¤ê³  ìƒê°í–ˆë‹¤. ì–´ì°¨í”¼ ê³µë¶€ë¥¼ í•˜ëŠ” ëª©ì ì¸ë° ì¡°ê¸ˆ ì–´ë ¤ìš°ë©´ ì–´ë–¤ê°€. ê²Œë‹¤ê°€ ì‚¬ë†“ì€ ê°•ì˜ë„ ìˆê¸°ì— í•˜ë‹¤ê°€ ë§‰íˆë©´ ê°•ì˜ë¥¼ ì°¸ê³ í•˜ë©´ì„œ ê³µë¶€í•  ì˜ˆì •ì´ë‹¤.

<br/>

<br/>

### ê¸°ë³¸ í˜ì´ì§€ ë§Œë“¤ê¸°

ìš°ì„  íƒ€ì„ë¦¬í”„ ì˜ì¡´ì„±ì„ ë“±ë¡í•˜ì. ì´ì œëŠ” ìµìˆ™í•´ì¡Œì„ í…Œì§€ë§Œ build.gradleì— ë“¤ì–´ê°€ì„œ ì˜ì¡´ì„±ì„ ì¶”ê°€í•˜ì.

```properties
implementation 'org.springframework.boot:spring-boot-starter-thymeleaf'
```

<br/>

##### src/main/resources/templates/index.html

```html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"> 
<head>
    <meta charset="UTF-8">
    <title>ìŠ¤í”„ë§ ë¶€íŠ¸ ì›¹ ì„œë¹„ìŠ¤</title>
</head>
<body>
    <h1>ìŠ¤í”„ë§ ë¶€íŠ¸ë¡œ ì‹œì‘í•˜ëŠ” ì›¹ ì„œë¹„ìŠ¤</h1>
</body>
</html>
```

íƒ€ì„ë¦¬í”„ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” \<html xmlns:th="http://www.thymeleaf.org"> í•´ë‹¹ ì½”ë“œë¥¼ ê¼­ ë„£ì–´ì£¼ì–´ì•¼ í•œë‹¤.

##### IndexController

```java
package web.purplebook.web;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.GetMapping;

@Controller
public class IndexController {

    @GetMapping("/")
    public String index(){
        return "index";
    }
}
```

<br/>

### í…ŒìŠ¤íŠ¸ì½”ë“œ ì‘ì„±

```java
package web.purplebook.web;

import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.boot.test.web.client.TestRestTemplate;

import static org.assertj.core.api.Assertions.assertThat;

@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)
class IndexControllerTest {
    
    @Autowired
    private TestRestTemplate restTemplate;

    @Test
    public void ë©”ì¸í˜ì´ì§€() throws Exception {
        //when
        String body = this.restTemplate.getForObject("/",String.class);

        //then
        assertThat(body).contains("ìŠ¤í”„ë§ ë¶€íŠ¸ë¡œ ì‹œì‘í•˜ëŠ” ì›¹ ì„œë¹„ìŠ¤"); // org.assertj.core.api.Assertions ë¥¼ static import
    }
}
```

í…ŒìŠ¤íŠ¸ ì½”ë“œë§Œ ì‘ì„±í•˜ê¸° ì•„ì‰¬ìš°ë‹ˆ ì§ì ‘ ë“¤ì–´ê°€ë³´ì.

localhost:8080 ìœ¼ë¡œ ë“¤ì–´ê°€ë©´ í™”ë©´ì´ ì˜ ì¶œë ¥ë  ê²ƒì´ë‹¤.

<br/>

## ê²Œì‹œê¸€ ë“±ë¡ í™”ë©´ ë§Œë“¤ê¸°

ì´ì „ í¬ìŠ¤íŒ…ì—ì„œ PostApiControllerë¥¼ í†µí•´ APIëŠ” êµ¬í˜„í•´ ë†“ì•˜ìœ¼ë‹ˆ ì´ì œ í™”ë©´ë§Œ ê°œë°œí•˜ë©´ ëœë‹¤.

[https://getbootstrap.kr/docs/5.1/getting-started/download/](https://getbootstrap.kr/docs/5.1/getting-started/download/) í•´ë‹¹ ì‚¬ì´íŠ¸ë¡œ ì´ë™í•´ì„œ ë¶€íŠ¸ìŠ¤íŠ¸ë©ì„ ë‹¤ìš´ë°›ì.

![image-20211121165407282](https://raw.githubusercontent.com/ShinDongHun1/image_repo/main/img/image-20211121165407282.png)



<br/>

ë‹¤ìš´ë°›ì€ íŒŒì¼ ì† css ì™€ jsë¥¼ ë³µì‚¬í•˜ì.

![image-20211121165456939](https://raw.githubusercontent.com/ShinDongHun1/image_repo/main/img/image-20211121165456939.png)

<br/>

##### src/main/resources/static ì•„ë˜ì— ë¶™ì—¬ë„£ê¸°ë¥¼ í•˜ì.

![image-20211121165620659](https://raw.githubusercontent.com/ShinDongHun1/image_repo/main/img/image-20211121165620659.png)

<br/>

<br/>

##### src/main/resources/templates/fragments/header.html

```html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:fragment="header">
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <!-- Custom styles for this template -->
    <link href="/css/jumbotron-narrow.css" rel="stylesheet">

    <title>Hello, world!</title>
</head>

```

<br/>

##### index.html ìˆ˜ì •

```html
<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header :: header">
    <title>Hello</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
</head>

<body>
    <h1>ìŠ¤í”„ë§ ë¶€íŠ¸ë¡œ ì‹œì‘í•˜ëŠ” ì›¹ ì„œë¹„ìŠ¤</h1>
    <div class="row">
        <div class="col-md-6">
            <a href="/posts/save" role="button" class="btn btn-primary">ê¸€ë“±ë¡</a>
        </div>
    </div>

    <div th:replace="fragments/footer :: footer" />
</body>
</html>
```

<br/>

##### posts-save.html ë“±ë¡

```html
<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header :: header">
  <title>Hello</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
</head>
<body>

  <h1>ê²Œì‹œê¸€ ë“±ë¡</h1>

  <div class="col-md-12">
    <div class="col-md-4">
      <form>
        <div class="form-group">
          <label for="title">ì œëª©</label>
          <input type="text" class="form-control" id="title" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
        </div>

        <div class="form-group">
          <label for="author">ì‘ì„±ì</label>
          <input type="text" class="form-control" id="author" placeholder="ì‘ì„±ìë¥¼ ì…ë ¥í•˜ì„¸ìš”">
        </div>

        <div class="form-group">
          <label for="content"> ë‚´ìš©</label>
          <textarea class="form-control" id="content" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
        </div>
      </form>
      <a href="/" role="button" class="btn btn-secondary">ì·¨ì†Œ</a>

      <button type="button" class="btn btn-primary" id="btn-save">ë“±ë¡</button>


    </div>
  </div>


  <div th:replace="fragments/footer :: footer" />
</body>
</html>
```

<br/>

##### index.js ë“±ë¡ (ê²½ë¡œ : resources/static/js/app/index.js)

![image-20211121174631587](https://raw.githubusercontent.com/ShinDongHun1/image_repo/main/img/image-20211121174631587.png)

```javascript
var main = {
    init : function () {
        var _this = this;
        $('#btn-save').on('click', function (){
        _this.save();
        });
    },
    save : function () {
        var data = {
            title: $('#title').val(),
            author: $('#author').val(),
            content: $('#content').val()
        };

        $.ajax({
            type: 'POST',
            url: '/api/v1/posts',
            dataType: 'json',
            contentType:'application/json; charset=utf-8',
            data: JSON.stringify(data)
        }).done(function (){
            alert('ê¸€ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
            window.location.href = '/';
        }).fail(function (error){
            alert(JSON.stringify(error));
        })

    }

};

main.init();
```

<br/>

##### src/main/resources/templates/fragments/footer.html ë“±ë¡

```html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<div class="footer" th:fragment="footer">
    <script type="text/javascript" th:src="@{/js/app/index.js}"></script>
</div>
```

<br/>

#### ì°¸ê³ 

ì½”ë“œë¥¼ ë³´ë©´ cssëŠ” header.htmlì—, jsëŠ”  footerì— ë‘ì—ˆëŠ”ë°, ì´ëŠ” í˜ì´ì§€ ë¡œë”©ì†ë„ë¥¼ ë†’ì´ê¸° ìœ„í•¨ì´ë‹¤.

HTMLì€ ìœ„ì—ì„œë¶€í„° ì½”ë“œê°€ ì‹¤í–‰ë˜ê¸° ë•Œë¬¸ì— jsëŠ” body í•˜ë‹¨ì— ë‘ì–´ í™”ë©´ì´ ë‹¤ ê·¸ë ¤ì§„ ë’¤ì— í˜¸ì¶œí•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.

<br/>

### ì´ì œ ì§ì ‘ í•œë²ˆ í™•ì¸í•´ë³´ì

#### ë©”ì¸ í™”ë©´

![image-20211121174757812](https://raw.githubusercontent.com/ShinDongHun1/image_repo/main/img/image-20211121174757812.png)

#### ê¸€ ë“±ë¡ í™”ë©´

![image-20211121174820457](https://raw.githubusercontent.com/ShinDongHun1/image_repo/main/img/image-20211121174820457.png)

<br/>

#### ë“±ë¡ ë²„íŠ¼ ëˆŒë €ì„ ë•Œ

![image-20211121174848431](https://raw.githubusercontent.com/ShinDongHun1/image_repo/main/img/image-20211121174848431.png)

<br/>

##### http://localhost:8080/h2-console ë¡œ ì´ë™ -> í™•ì¸

![image-20211121174920402](https://raw.githubusercontent.com/ShinDongHun1/image_repo/main/img/image-20211121174920402.png)

<br/>

<br/>

<br/>

## ì „ì²´ ì¡°íšŒ í™”ë©´ ë§Œë“¤ê¸°

##### index.html ìˆ˜ì •

```html
<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header :: header">
    <title>Hello</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
</head>

<body>
    <h1>ìŠ¤í”„ë§ ë¶€íŠ¸ë¡œ ì‹œì‘í•˜ëŠ” ì›¹ ì„œë¹„ìŠ¤</h1>
    <div class="col-md-12">
        <div class="row">
            <div class="col-md-6">
                <a href="/posts/save" role="button" class="btn btn-primary">ê¸€ë“±ë¡</a>
            </div>
        </div>
        <br/>
        <!-- ëª©ë¡ ì¶œë ¥ ì˜ì—­ -->
        <table class="table table-horizontal table-bordered">
            <thead class="thead-strong">
            <tr>
                <th>ê²Œì‹œê¸€ë²ˆí˜¸</th>
                <th>ì œëª©</th>
                <th>ì‘ì„±ì</th>
                <th>ìµœì¢…ìˆ˜ì •ì¼</th>
            </tr>
            </thead>
            
            <tbody id="tbody">
                <tr th:each="post : ${posts}">
                    <td th:text="${post.id}"></td>
                    <td th:text="${post.title}"></td>
                    <td th:text="${post.author}"></td>
                    <td th:text="${post.modifiedDate}"></td>
                </tr>
            </tbody>
        </table>
    </div>

    <div th:replace="fragments/footer :: footer" />
</body>
</html>
```

##### th:each="post : ${posts}" ëŠ” íƒ€ì„ë¦¬í”„ì˜ ë°˜ë³µë¬¸ì´ë‹¤. ìë°”ì˜ for-eachë¬¸ê³¼ ë¹„ìŠ·í•˜ì§€ ì•Šì€ê°€? ê·¸ëŸ¼ ì € postsëŠ” ì–´ë””ì„œ ë„£ì–´ì£¼ë‚˜??? ì•„ë˜ IndexControllerì—ì„œ ì„¤ëª…í•˜ê² ë‹¤.

<br/>

<br/>

##### PostsRepository ìˆ˜ì •

```java
package web.purplebook.repository;

import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import web.purplebook.domain.posts.Posts;

import java.util.List;

public interface PostsRepository extends JpaRepository<Posts, Long> {

    @Query("select p from Posts p order by p.id desc")
    List<Posts> findAllDesc();
}
```

<br/>

##### PostsListResponseDto ìƒì„±

```java
package web.purplebook.web.dto;

import lombok.Getter;
import web.purplebook.domain.posts.Posts;

import java.time.LocalDateTime;

@Getter
public class PostsListResponseDto {
    private Long id;
    private String title;
    private String author;
    private LocalDateTime modifiedDate;

    public PostsListResponseDto(Posts entity) {
        this.id = entity.getId();
        this.title = entity.getTitle();
        this.author = entity.getAuthor();
        this.modifiedDate = entity.getModifiedDate();
    }
}
```

<br/>

##### PostServiceì— ì¶”ê°€

```java
@Transactional(readOnly = true)
public List<PostsListResponseDto> findAllDesc(){
    return postsRepository.findAllDesc().stream()
            .map(PostsListResponseDto::new)//posts -> new PostsListResponseDto(posts)
            .toList();
}
```

##### ì¡°íšŒí•œ Posts ì˜ Listë¥¼ PostsListResponseDtoì˜ Listë¡œ ë³€í™˜

<br/>

##### IndexController ìˆ˜ì •(ë©”ì¸ í™”ë©´ì—ì„œ ê²Œì‹œê¸€ ë¦¬ìŠ¤íŠ¸ ë³¼ ìˆ˜ ìˆë„ë¡)

```java
package web.purplebook.web;

import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import web.purplebook.service.posts.PostsService;

@Controller
@RequiredArgsConstructor
public class IndexController {

    private final PostsService postsService;
    
    @GetMapping("/")
    public String index(Model model){
        model.addAttribute("posts", postsService.findAllDesc());
        return "index";
    }

    @GetMapping("/posts/save")
    public String postsSave(){
        return "posts-save";
    }
}
```

##### ì•„ê¹Œ ì„¤ëª…í•˜ê¸°ë¡œ í•œ postsë¥¼ ë„£ì–´ì£¼ëŠ” ì½”ë“œì´ë‹¤. model.addAttributeë¥¼ í†µí•´ htmlì˜ postsì— postsService.findAllDesc()ë¥¼ í†µí•´ ë‚˜ì˜¨ PostsListResponseDtoì˜ Listë¥¼ ë„£ì–´ì¤€ë‹¤ëŠ” ì˜ë¯¸ì´ë‹¤.

<br/>

<br/>

#### ì´ì œ í™•ì¸í•´ë³´ì

![image-20211121180801614](https://raw.githubusercontent.com/ShinDongHun1/image_repo/main/img/image-20211121180801614.png)

ì˜ ë‚˜ì˜¨ë‹¤ êµ³!!!!!!

<br/>

<br/>

<br/>

### ê²Œì‹œê¸€ ìˆ˜ì • 

##### posts-update-html ë“±ë¡

![image-20211121183926994](https://raw.githubusercontent.com/ShinDongHun1/image_repo/main/img/image-20211121183926994.png)

```html
<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header :: header">
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
</head>
<body>

  <div class="col-md-12">
    <div class="col-md-4">
    <form th:object="${post}" method="post">
      <div class="form-group">
        <label th:for="id">ê¸€ ë²ˆí˜¸</label>
        <input type="text" th:field="*{id}" class="form-control" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" readonly />
      </div>

      <div class="form-group">
        <label th:for="title">ì œëª©</label>
        <input type="text" th:field="*{title}" class="form-control" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" />
      </div>
      <div class="form-group">
        <label th:for="author">ì‘ì„±ì</label>
        <input type="text" th:field="*{author}" class="form-control" placeholder="ê°€ê²©ì„ ì…ë ¥í•˜ì„¸ìš”" readonly/>
      </div>
      <div class="form-group">
        <label th:for="content">ë‚´ìš©</label>
        <textarea class="form-control" id="content" th:field="*{content}"></textarea>
      </div>
    </form>

    <a href="/" role="button" class="btn btn-secondary">ì·¨ì†Œ</a>

    <button type="button" class="btn btn-primary" id="btn-update">ìˆ˜ì • ì™„ë£Œ</button>


    </div>

  </div>

  <div th:replace="fragments/footer :: footer" />
</body>
</html>

```

#### th:object

##### form submitì„ í•  ë•Œ, formì˜ ë°ì´í„°ê°€ th:objectì— ì„¤ì •í•´ì¤€ ê°ì²´ë¡œ ë°›ì•„ì§„ë‹¤.

<br/>

##### index.js ìˆ˜ì • (ì—…ë°ì´íŠ¸ ê¸°ëŠ¥ ì¶”ê°€)

```javascript
var main = {
    init : function () {
        var _this = this;
        $('#btn-save').on('click', function (){
        _this.save();
        });

        //ì—…ë°ì´íŠ¸ ê¸°ëŠ¥ ì¶”ê°€
        $('#btn-update').on('click', function (){  
            _this.update();
        });
    },
    save : function () {
        var data = {
            title: $('#title').val(),
            author: $('#author').val(),
            content: $('#content').val()
        };

        $.ajax({
            type: 'POST',
            url: '/api/v1/posts',
            dataType: 'json',
            contentType:'application/json; charset=utf-8',
            data: JSON.stringify(data)
        }).done(function (){
            alert('ê¸€ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
            window.location.href = '/';
        }).fail(function (error){
            alert(JSON.stringify(error));
        });
    },

    
    //ì—…ë°ì´íŠ¸ ê¸°ëŠ¥ ì¶”ê°€
    update : function () {
        var data = {
            title: $('#title').val(),
            content: $('#content').val()
        };

        var id = $('#id').val();

        $.ajax({
            type: 'PUT',
            url: '/api/v1/posts/'+id,
            dataType: 'json',
            contentType:'application/json; charset=utf-8',
            data: JSON.stringify(data)
        }).done(function (){
            alert('ê¸€ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
            window.location.href = '/';
        }).fail(function (error){
            alert(JSON.stringify(error));
        });
    }

};

main.init();
```

<br/>

##### index.html ìˆ˜ì • (ìˆ˜ì • í˜ì´ì§€ë¡œ ì´ë™í•  ìˆ˜ ìˆë„ë¡ ìˆ˜ì •)

```html
<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header :: header">
    <title>Hello</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
</head>

<body>
    <h1>ìŠ¤í”„ë§ ë¶€íŠ¸ë¡œ ì‹œì‘í•˜ëŠ” ì›¹ ì„œë¹„ìŠ¤</h1>
    <div class="col-md-12">
        <div class="row">
            <div class="col-md-6">
                <a href="/posts/save" role="button" class="btn btn-primary">ê¸€ë“±ë¡</a>
            </div>
        </div>
        <br/>
        <!-- ëª©ë¡ ì¶œë ¥ ì˜ì—­ -->
        <table class="table table-horizontal table-bordered">
            <thead class="thead-strong">
            <tr>
                <th>ê²Œì‹œê¸€ë²ˆí˜¸</th>
                <th>ì œëª©</th>
                <th>ì‘ì„±ì</th>
                <th>ìµœì¢…ìˆ˜ì •ì¼</th>
            </tr>
            </thead>

            <tbody id="tbody">
                <tr th:each="post : ${posts}">
                    <td th:text="${post.id}"></td>
                    <td>
                        <a href="#" th:href="@{/posts/update/{id} (id=${post.id})}" th:text="${post.title}">ìˆ˜ì •</a>
                    </td>
                    <td th:text="${post.author}"></td>
                    <td th:text="${post.modifiedDate}"></td>
                    <td>
                        <a href="#" th:href="@{/posts/update/{id} (id=${post.id})}" class="btn btn-primary" role="button">ìˆ˜ì •</a>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <div th:replace="fragments/footer :: footer" />
</body>
</html>

```

<br/>

##### IndexController ìˆ˜ì •

```java
package web.purplebook.web;

import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import web.purplebook.service.posts.PostsService;
import web.purplebook.web.dto.PostsResponseDto;

@Controller
@RequiredArgsConstructor
public class IndexController {

    private final PostsService postsService;

    @GetMapping("/")
    public String index(Model model){
        model.addAttribute("posts", postsService.findAllDesc());
        return "index";
    }

    @GetMapping("/posts/save")
    public String postsSave(){
        return "posts-save";
    }

    
    //== ì—…ë°ì´íŠ¸ ì¶”ê°€ ==//
    @GetMapping("/posts/update/{id}")
    public String postsUpdate(@PathVariable("id")Long id, Model model) {
        PostsResponseDto dto = postsService.findById(id);
        model.addAttribute("post",dto);
        return "posts-update";
    }
}
```

<br/>

### í™•ì¸í•´ë³´ì

![image-20211121190243489](https://raw.githubusercontent.com/ShinDongHun1/image_repo/main/img/image-20211121190243489.png)

![image-20211121190255873](https://raw.githubusercontent.com/ShinDongHun1/image_repo/main/img/image-20211121190255873.png)

![image-20211121190309155](https://raw.githubusercontent.com/ShinDongHun1/image_repo/main/img/image-20211121190309155.png)

<br/>

<br/>

<br/>

### ê²Œì‹œë¬¼ ì‚­ì œ

ì§„ì§œ ë§ˆì§€ë§‰ì´ë‹¤!!! ê²Œì‹œë¬¼ì„ ì‚­ì œí•˜ëŠ” ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ì.

##### posts-update.html ìˆ˜ì •

```html
<button type="button" class="btn btn-danger" id="btn-delete">ì‚­ì œ</button>
```

ì´ê±° í•˜ë‚˜ë§Œ ë„£ì–´ì£¼ë©´ ë˜ì§€ë§Œ... í˜¹ì‹œ ëª¨ë¥´ë‹ˆ ì „ì²´ ì½”ë“œ

```html
<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header :: header">
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
</head>
<body>

  <div class="col-md-12">
    <div class="col-md-4">
    <form th:object="${post}" method="post">
      <div class="form-group">
        <label th:for="id">ê¸€ ë²ˆí˜¸</label>
        <input type="text" th:field="*{id}" class="form-control" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" readonly />
      </div>

      <div class="form-group">
        <label th:for="title">ì œëª©</label>
        <input type="text" th:field="*{title}" class="form-control" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" />
      </div>
      <div class="form-group">
        <label th:for="author">ì‘ì„±ì</label>
        <input type="text" th:field="*{author}" class="form-control" placeholder="ê°€ê²©ì„ ì…ë ¥í•˜ì„¸ìš”" readonly/>
      </div>
      <div class="form-group">
        <label th:for="content">ë‚´ìš©</label>
        <textarea class="form-control" id="content" th:field="*{content}"></textarea>
      </div>
    </form>

      <a href="/" role="button" class="btn btn-secondary">ì·¨ì†Œ</a>

      <button type="button" class="btn btn-primary" id="btn-update">ìˆ˜ì • ì™„ë£Œ</button>
        <!-- ì‚­ì œ -->
      <button type="button" class="btn btn-danger" id="btn-delete">ì‚­ì œ</button>


    </div>

  </div> 

  <div th:replace="fragments/footer :: footer" />
</body>
</html>
```

<br/>

##### index.js ìˆ˜ì •

```html
var main = {
    init : function () {
        var _this = this;
        $('#btn-save').on('click', function (){
        _this.save();
        });

        $('#btn-update').on('click', function (){
            _this.update();
        });

        $('#btn-delete').on('click', function (){
            _this.delete();
        });
    },
    save : function () {
        var data = {
            title: $('#title').val(),
            author: $('#author').val(),
            content: $('#content').val()
        };

        $.ajax({
            type: 'POST',
            url: '/api/v1/posts',
            dataType: 'json',
            contentType:'application/json; charset=utf-8',
            data: JSON.stringify(data)
        }).done(function (){
            alert('ê¸€ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
            window.location.href = '/';
        }).fail(function (error){
            alert(JSON.stringify(error));
        });
    },

    update : function () {
        var data = {
            title: $('#title').val(),
            content: $('#content').val()
        };

        var id = $('#id').val();

        $.ajax({
            type: 'PUT',
            url: '/api/v1/posts/'+id,
            dataType: 'json',
            contentType:'application/json; charset=utf-8',
            data: JSON.stringify(data)
        }).done(function (){
            alert('ê¸€ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
            window.location.href = '/';
        }).fail(function (error){
            alert(JSON.stringify(error));
        });
    },
    
    
    delete : function () {

        var id = $('#id').val();

        $.ajax({
            type: 'DELETE',
            url: '/api/v1/posts/'+id,
            dataType: 'json',
            contentType:'application/json; charset=utf-8',
        }).done(function (){
            alert('ê¸€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            window.location.href = '/';
        }).fail(function (error){
            alert(JSON.stringify(error));
        });
    }
    

};

main.init();
```

<br/>

##### PostsService ìˆ˜ì •

```java
package web.purplebook.service.posts;

import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;
import web.purplebook.domain.posts.Posts;
import web.purplebook.repository.PostsRepository;
import web.purplebook.web.dto.PostsListResponseDto;
import web.purplebook.web.dto.PostsResponseDto;
import web.purplebook.web.dto.PostsSaveRequestDto;
import web.purplebook.web.dto.PostsUpdateRequestDto;

import java.util.List;

@Service
@RequiredArgsConstructor
public class PostsService {
    private final PostsRepository postsRepository;

    @Transactional
    public Long save(PostsSaveRequestDto requestDto){
        return postsRepository.save(requestDto.toEntity()).getId();
    }

    @Transactional
    public Long update(Long id, PostsUpdateRequestDto requestDto) {
        Posts posts = postsRepository.findById(id).orElseThrow(() -> new IllegalArgumentException("í•´ë‹¹ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤. id=" + id));

        posts.update(requestDto.getTitle(), requestDto.getContent());
        return id;
    }


    @Transactional
    public PostsResponseDto findById(Long id) {
        Posts entity = postsRepository.findById(id).orElseThrow(() -> new IllegalArgumentException("í•´ë‹¹ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤. id=" + id));
        return new PostsResponseDto(entity);
    }

    @Transactional(readOnly = true)
    public List<PostsListResponseDto> findAllDesc(){
        return postsRepository.findAllDesc().stream()
                .map(PostsListResponseDto::new)//posts -> new PostsListResponseDto(posts)
                .toList();
    }
    
    
    // ì‚­ì œ ì¶”ê°€
    @Transactional
    public void delete(Long id){
        Posts posts = postsRepository.findById(id).orElseThrow(() -> new IllegalArgumentException("í•´ë‹¹ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤. id=" + id));
        postsRepository.delete(posts);
    }
}
```

<br/>

##### PostsApiController ìˆ˜ì •

```java
package web.purplebook.web;

import lombok.RequiredArgsConstructor;
import org.springframework.web.bind.annotation.*;
import web.purplebook.service.posts.PostsService;
import web.purplebook.web.dto.PostsResponseDto;
import web.purplebook.web.dto.PostsSaveRequestDto;
import web.purplebook.web.dto.PostsUpdateRequestDto;

@RequiredArgsConstructor
@RestController
public class PostsApiController {

    private final PostsService postsService;

    @PostMapping("/api/v1/posts")
    public Long save(@RequestBody PostsSaveRequestDto requestDto){
        return postsService.save(requestDto);
    }

    @PutMapping("/api/v1/posts/{id}")
    public Long update(@PathVariable("id") Long id, @RequestBody PostsUpdateRequestDto requestDto){
        return postsService.update(id,requestDto);
    }

    @GetMapping("/api/v1/posts/{id}")
    public PostsResponseDto findById(@PathVariable("id") Long id){
        return postsService.findById(id);
    }


    //ì¶”ê°€
    @DeleteMapping("/api/v1/posts/{id}")
    public Long delete(@PathVariable("id") Long id){
        postsService.delete(id);
        return id;
    }
}
```

<br/>

### í…ŒìŠ¤íŠ¸í•´ë³´ì

![image-20211121191942881](https://raw.githubusercontent.com/ShinDongHun1/image_repo/main/img/image-20211121191942881.png)

##### êµ³ ì˜ëœë‹¤!!!!!

<br/>

<br/>

ì´ë ‡ê²Œ í•´ì„œ ì˜¤ëŠ˜ì€ íƒ€ì„ë¦¬í”„ë¥¼ ì‚¬ìš©í•´ì„œ í™”ë©´ì„ ë§Œë“¤ì–´ ë³´ì•˜ë‹¤! 

ì´ì œ íšŒì›ê°€ì…ê³¼ ë¡œê·¸ì¸, ê¶Œí•œ ê¸°ëŠ¥ë§Œ ì¶”ê°€í•œë‹¤ë©´ ê°„ë‹¨í•œ ê²Œì‹œíŒì„ ë‹¤ ë§Œë“¤ì–´ ë³¸ ê²ƒì´ë‹¤!!!

ë‹¤ìŒ ì‹œê°„ì—ëŠ” ì†Œì…œ ë¡œê·¸ì¸ ê¸°ëŠ¥ê³¼, ë¡œê·¸ì¸ì„ í•˜ì§€ ì•Šìœ¼ë©´ ê¸€ì„ ì“¸ ìˆ˜ ì—†ê²Œë” ì œí•œì„ ë‘¬ë³´ê² ë‹¤.

<br/>

<br/>

### ğŸ“” Reference

##### ìŠ¤í”„ë§ ë¶€íŠ¸ì™€ AWSë¡œ í˜¼ì êµ¬í˜„í•˜ëŠ” ì›¹ ì„œë¹„ìŠ¤ 124~161P