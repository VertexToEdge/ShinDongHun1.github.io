---
title:  "í˜ì´ì§•"
excerpt: "ë°ì´í„° JPA í˜ì´ì§•"
date:   2021-10-26 01:50:00
header:
  teaser: /assets/images/spring.png

categories: DATA
tags:
  - Java
  - Spring
  - JPA
  - DATA JPA
  - í˜ì´ì§•
last_modified_at: 2021-10-26T01:50:00

---

<br/>

## ğŸ’¡ í˜ì´ì§•ê³¼ ì •ë ¬ íŒŒë¼ë¯¸í„°

##### org.springframework.data.domain.Sort : ì •ë ¬ ê¸°ëŠ¥ 

##### org.springframework.data.domain.Pageable : í˜ì´ì§• ê¸°ëŠ¥ (ë‚´ë¶€ì— Sort í¬í•¨)

<br/>

### ë°˜í™˜ íƒ€ì…

- ##### org.springframework.data.domain.Page : ì¶”ê°€ count ì¿¼ë¦¬ ê²°ê³¼ë¥¼ í¬í•¨í•˜ëŠ” í˜ì´ì§• 

- ##### org.springframework.data.domain.Slice : ì¶”ê°€ count ì¿¼ë¦¬ ì—†ì´ ë‹¤ìŒ í˜ì´ì§€ë§Œ í™•ì¸ ê°€ëŠ¥ (ë‚´ë¶€ì ìœ¼ë¡œ limit + 1ì¡°íšŒ) 

- ##### List (ìë°” ì»¬ë ‰ì…˜): ì¶”ê°€ count ì¿¼ë¦¬ ì—†ì´ ê²°ê³¼ë§Œ ë°˜í™˜

<br/>

#### í˜ì´ì§•ê³¼ ì •ë ¬ ì‚¬ìš© ì˜ˆì œ 

```java
Page findByUsername(String name, Pageable pageable); //count ì¿¼ë¦¬ ì‚¬ìš© 

Slice findByUsername(String name, Pageable pageable); //count ì¿¼ë¦¬ ì‚¬ìš© ì•ˆí•¨ 

List findByUsername(String name, Pageable pageable); //count ì¿¼ë¦¬ ì‚¬ìš© ì•ˆí•¨ 

List findByUsername(String name, Sort sort);
```

<br/>

#### Pageable êµ¬í˜„

```java
PageRequest pageRequest = PageRequest.of(0, 3, Sort.by(Sort.Direction.DESC, "username"));
//           						  page, size,          usernameì— ëŒ€í•´ DESCë¡œ ì •ë ¬
//sizeê°œì”© ë‚˜ëˆ´ì„ ë•Œ, pageì˜ ë“¤ì–´ê°„ ê°’ì— í•´ë‹¹í•˜ëŠ” í˜ì´ì§€ì˜ ê²°ê³¼ë“¤ì„ ì¡°íšŒ


//ì‚¬ìš©
Page<Member> page = memberRepository.findByAge(age, pageRequest);

List<Member> content = page.getContent();
long totalCount = page.getTotalElements();//ëª¨ë“  elementë“¤ì˜ ìˆ˜,SliceëŠ” ì‚¬ìš©ë¶ˆê°€
int pageNumber = page.getNumber();//í˜„ì¬ í˜ì´ì§€ì˜ ë²ˆí˜¸
int totalPage = page.getTotalPages();//ì´ í˜ì´ì§€ì˜ ê°œìˆ˜, SliceëŠ” ì‚¬ìš©ë¶ˆê°€
boolean isFirst = page.isFirst();//ê°€ì ¸ì˜¨ í˜ì´ì§€ê°€ ì²«ë²ˆì§¸ í˜ì´ì§€ë©´ true
boolean hasNext = page.hasNext();//ë‹¤ìŒ í˜ì´ì§€ê°€ ìˆìœ¼ë©´ true
```

##### PageRequest ìƒì„±ìì˜ ì²« ë²ˆì§¸ íŒŒë¼ë¯¸í„°ì—ëŠ” í˜„ì¬ í˜ì´ì§€ë¥¼, ë‘ ë²ˆì§¸ íŒŒë¼ë¯¸í„°ì—ëŠ” ì¡°íšŒí•  ë°ì´í„° ìˆ˜ë¥¼ ì…ë ¥í•œë‹¤. ì—¬ê¸°ì— ì¶”ê°€ë¡œ ì •ë ¬ ì •ë³´ë„ íŒŒë¼ë¯¸í„°ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. ì°¸ê³ ë¡œ í˜ì´ì§€ëŠ” 0ë¶€í„° ì‹œì‘í•œë‹¤.

<br/>

<br/>

#### Page ì¸í„°í˜ì´ìŠ¤

```java
public interface Page extends Slice { 
	int getTotalPages(); //ì „ì²´ í˜ì´ì§€ ìˆ˜ 
	long getTotalElements(); //ì „ì²´ ë°ì´í„° ìˆ˜  
	Page map(Function converter); //ë³€í™˜ê¸° 
}
```

<br/>

<br/>

#### Slice ì¸í„°í˜ì´ìŠ¤

```java
public interface Slice extends Streamable { 
	int getNumber(); //í˜„ì¬ í˜ì´ì§€ 
	int getSize(); //í˜ì´ì§€ í¬ê¸° 
	int getNumberOfElements(); //í˜„ì¬ í˜ì´ì§€ì— ë‚˜ì˜¬ ë°ì´í„° ìˆ˜ 
	List getContent(); //ì¡°íšŒëœ ë°ì´í„° 
	boolean hasContent(); //ì¡°íšŒëœ ë°ì´í„° ì¡´ì¬ ì—¬ë¶€ 
	Sort getSort(); //ì •ë ¬ ì •ë³´ 
	boolean isFirst(); //í˜„ì¬ í˜ì´ì§€ê°€ ì²« í˜ì´ì§€ ì¸ì§€ ì—¬ë¶€ 
	boolean isLast(); //í˜„ì¬ í˜ì´ì§€ê°€ ë§ˆì§€ë§‰ í˜ì´ì§€ ì¸ì§€ ì—¬ë¶€ 
	boolean hasNext(); //ë‹¤ìŒ í˜ì´ì§€ ì—¬ë¶€ 
	boolean hasPrevious(); //ì´ì „ í˜ì´ì§€ ì—¬ë¶€ 
	Pageable getPageable(); //í˜ì´ì§€ ìš”ì²­ ì •ë³´ 
	Pageable nextPageable(); //ë‹¤ìŒ í˜ì´ì§€ ê°ì²´ 
	Pageable previousPageable();//ì´ì „ í˜ì´ì§€ ê°ì²´ 
	Slice map(Function converter); //ë³€í™˜ê¸° 
}
```

<br/>

<br/>

#### ì°¸ê³ : count ì¿¼ë¦¬ë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ë¶„ë¦¬í•  ìˆ˜ ìˆìŒ 

```java
@Query(value = â€œselect m from Member m left join m.team tâ€, 
       countQuery = â€œselect count(m.username) from Member mâ€) 
Page findMemberAllCountBy(Pageable pageable);
```

##### ì™œ ë¶„ë¦¬ë¥¼ í•˜ë‚˜? => ë°ì´í„°ë¥¼ joiní•´ì„œ ê°€ì ¸ì˜¬ ì‹œì—ëŠ” , count ì¿¼ë¦¬ë„ joinì„ í•˜ê²Œëœë‹¤. 

##### ë°ì´í„°ì˜ ê°œìˆ˜ê°€ ë³€í™”ê°€ ì—†ëŠ” left outer joinì„ í•  ê²½ìš° joinì„ í•  í•„ìš” ì—†ì´ countì¿¼ë¦¬ë§Œ ìˆ˜í–‰í•˜ê²Œ ë˜ë©´ ì„±ëŠ¥ ìµœì í™”ë¥¼ ì´ë£° ìˆ˜ ìˆìœ¼ë¯€ë¡œ ìœ„ì²˜ëŸ¼ count ì¿¼ë¦¬ë¥¼ ë¶„ë¦¬í•´ì„œ ì‚¬ìš©í•œë‹¤.

<br/>

<br/>

### DTOë¡œ ë³€í™˜í•˜ê¸°

##### í˜ì´ì§€ë¥¼ ìœ ì§€í•˜ë©´ì„œ ì—”í‹°í‹°ë¥¼ DTOë¡œ ë³€í™˜í•˜ê¸°

```java
Page<Member> page = memberRepository.findByAge(10, pageRequest);
Page<MemberDto> dtoPage = page.map(m -> new MemberDto(m));//mapì„ ì‚¬ìš©
```

<br/>

<br/>

### ğŸ“” Reference

[ì¸í”„ëŸ° - ì‹¤ì „! ìŠ¤í”„ë§ ë°ì´í„° JPA](https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81-%EB%8D%B0%EC%9D%B4%ED%84%B0-JPA-%EC%8B%A4%EC%A0%84/dashboard)

