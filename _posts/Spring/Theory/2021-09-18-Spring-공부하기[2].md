---
title:  "Spring 공부하기[2]"
excerpt: "DI, IoC, 컨테이너"
date:   2021-09-18 02:59:00 +0900
header:
  teaser: /assets/images/spring.png

categories: javaSpring
tags:
  - Java
  - Spring
last_modified_at: 2021-09-18T02:59:00-05:00



---

<br/>

<br/>

💡 내가 듣는 강의 - [스프링 핵심 원리 - 기본편](https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81-%ED%95%B5%EC%8B%AC-%EC%9B%90%EB%A6%AC-%EA%B8%B0%EB%B3%B8%ED%8E%B8)

<br/>

## 💡 DI, 의존관계 주입

### ✏ 관심사의 분리

다시 다음과 같은 코드를 보자

<div class="colorscripter-code" style="color:#010101;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important; position:relative !important;overflow:auto"><table class="colorscripter-code-table" style="margin:0;padding:0;border:none;background-color:#fafafa;border-radius:4px;" cellspacing="0" cellpadding="0"><tr><td style="padding:6px;border-right:2px solid #e5e5e5"><div style="margin:0;padding:0;word-break:normal;text-align:right;color:#666;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important;line-height:130%"><div style="line-height:130%">1</div><div style="line-height:130%">2</div><div style="line-height:130%">3</div><div style="line-height:130%">4</div></div></td><td style="padding:6px 0;text-align:left"><div style="margin:0;padding:0;color:#010101;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important;line-height:130%"><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#a71d5d">public</span>&nbsp;<span style="color:#a71d5d">class</span>&nbsp;OrderServiceImpl&nbsp;<span style="color:#a71d5d">implements</span>&nbsp;OrderService&nbsp;{</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">//&nbsp;private&nbsp;final&nbsp;DiscountPolicy&nbsp;discountPolicy&nbsp;=&nbsp;new&nbsp;FixDiscountPolicy();</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;<span style="color:#a71d5d">private</span>&nbsp;<span style="color:#a71d5d">final</span>&nbsp;DiscountPolicy&nbsp;discountPolicy&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;<span style="color:#a71d5d">new</span>&nbsp;RateDiscountPolicy();</div><div style="padding:0 6px; white-space:pre; line-height:130%">}</div></div><div style="text-align:right;margin-top:-13px;margin-right:5px;font-size:9px;font-style:italic"><a href="http://colorscripter.com/info#e" target="_blank" style="color:#e5e5e5text-decoration:none">Colored by Color Scripter</a></div></td><td style="vertical-align:bottom;padding:0 2px 4px 0"><a href="http://colorscripter.com/info#e" target="_blank" style="text-decoration:none;color:white"><span style="font-size:9px;word-break:normal;background-color:#e5e5e5;color:white;border-radius:10px;padding:1px">cs</span></a></td></tr></table></div>

이전 글에서 적었던 것 처럼 다형성을 활용하고, 인터페이스와 구현 객체를 분리했으나

**OCP, DIP를 만족시키지 못하였다.**<br/>(OCP, DIP를 모르겠다면? -> [스프링 공부하기-[1]](https://shindonghun1.github.io/javaspring/Spring-%EA%B3%B5%EB%B6%80%ED%95%98%EA%B8%B0-1/))

<br/>

💡 어떻게 해결하면 좋을까?

✏ **인터페이스만 의존하도록 변경하자!**

다음은 인터페이스에만 의존하도록 짠 코드이다.

<div class="colorscripter-code" style="color:#010101;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important; position:relative !important;overflow:auto"><table class="colorscripter-code-table" style="margin:0;padding:0;border:none;background-color:#fafafa;border-radius:4px;" cellspacing="0" cellpadding="0"><tr><td style="padding:6px;border-right:2px solid #e5e5e5"><div style="margin:0;padding:0;word-break:normal;text-align:right;color:#666;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important;line-height:130%"><div style="line-height:130%">1</div><div style="line-height:130%">2</div><div style="line-height:130%">3</div></div></td><td style="padding:6px 0;text-align:left"><div style="margin:0;padding:0;color:#010101;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important;line-height:130%"><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#a71d5d">public</span>&nbsp;<span style="color:#a71d5d">class</span>&nbsp;OrderServiceImpl&nbsp;<span style="color:#a71d5d">implements</span>&nbsp;OrderService&nbsp;{</div><div style="background-color:#f0f0f0; padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#a71d5d">private</span>&nbsp;DiscountPolicy&nbsp;discountPolicy;</div><div style="padding:0 6px; white-space:pre; line-height:130%">}</div></div><div style="text-align:right;margin-top:-13px;margin-right:5px;font-size:9px;font-style:italic"><a href="http://colorscripter.com/info#e" target="_blank" style="color:#e5e5e5text-decoration:none">Colored by Color Scripter</a></div></td><td style="vertical-align:bottom;padding:0 2px 4px 0"><a href="http://colorscripter.com/info#e" target="_blank" style="text-decoration:none;color:white"><span style="font-size:9px;word-break:normal;background-color:#e5e5e5;color:white;border-radius:10px;padding:1px">cs</span></a></td></tr></table></div>

그럼 이제 이런 의문이 들어야 정상이다:D 

=>구현체가 없는데 코드는 어떻게 실행하는데!!!

<br/>

#### ✏ 해결방안

**"해 줘"**

이 문제를 해결하려면 누군가가 클라이언트인 OrderServiceImpl 에 DiscountPolicy 의 구현 객체를 대신 생성하고 주입해주어야 한다.<br/>공연을 할 때 배우는 자기 역할을 수행하는 것에만 집중해야지, 상대 배우가 누구인지는 관심을 가질 필요가 없다. <br/>이전 코드는 마치 배우가 상대 배우를 직접 고르는 것과 같은 느낌이다.

똑같은 문맥으로 OrderServiceImpl도 discountPolicy에 누가 들어오는지는 알 바 아니다.

✏ **관심사를 분리하자.**

배우는 연기하는 것만 신경쓰고 상대 배우는 감독에게 맡기자!

공연을 설계하고, 담당 배우를 섭외하는것을 책임지는 감독을 추가해보자

 <br/>

 <br/>

#### 💻 AppConfig 설정

<div class="colorscripter-code" style="color:#010101;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important; position:relative !important;overflow:auto"><table class="colorscripter-code-table" style="margin:0;padding:0;border:none;background-color:#fafafa;border-radius:4px;" cellspacing="0" cellpadding="0"><tr><td style="padding:6px;border-right:2px solid #e5e5e5"><div style="margin:0;padding:0;word-break:normal;text-align:right;color:#666;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important;line-height:130%"><div style="line-height:130%">1</div><div style="line-height:130%">2</div><div style="line-height:130%">3</div><div style="line-height:130%">4</div><div style="line-height:130%">5</div><div style="line-height:130%">6</div><div style="line-height:130%">7</div><div style="line-height:130%">8</div><div style="line-height:130%">9</div><div style="line-height:130%">10</div><div style="line-height:130%">11</div><div style="line-height:130%">12</div><div style="line-height:130%">13</div><div style="line-height:130%">14</div><div style="line-height:130%">15</div><div style="line-height:130%">16</div><div style="line-height:130%">17</div><div style="line-height:130%">18</div></div></td><td style="padding:6px 0;text-align:left"><div style="margin:0;padding:0;color:#010101;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important;line-height:130%"><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#a71d5d">public</span>&nbsp;<span style="color:#a71d5d">class</span>&nbsp;AppConfig&nbsp;{</div><div style="background-color:#f0f0f0; padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#a71d5d">public</span>&nbsp;MemberService&nbsp;memberService()&nbsp;{</div><div style="background-color:#f0f0f0; padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#a71d5d">return</span>&nbsp;<span style="color:#a71d5d">new</span>&nbsp;MemberServiceImpl(memberRepository());</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</div><div style="background-color:#f0f0f0; padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#a71d5d">public</span>&nbsp;OrderService&nbsp;orderService()&nbsp;{</div><div style="background-color:#f0f0f0; padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#a71d5d">return</span>&nbsp;<span style="color:#a71d5d">new</span>&nbsp;OrderServiceImpl(memberRepository(),discountPolicy());</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;}</div><div style="background-color:#f0f0f0; padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#a71d5d">public</span>&nbsp;MemberRepository&nbsp;memberRepository()&nbsp;{</div><div style="background-color:#f0f0f0; padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#a71d5d">return</span>&nbsp;<span style="color:#a71d5d">new</span>&nbsp;MemoryMemberRepository();</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</div><div style="background-color:#f0f0f0; padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#a71d5d">public</span>&nbsp;DiscountPolicy&nbsp;discountPolicy()&nbsp;{</div><div style="background-color:#f0f0f0; padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#a71d5d">return</span>&nbsp;<span style="color:#a71d5d">new</span>&nbsp;FixDiscountPolicy();</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</div><div style="background-color:#f0f0f0; padding:0 6px; white-space:pre; line-height:130%">}</div></div><div style="text-align:right;margin-top:-13px;margin-right:5px;font-size:9px;font-style:italic"><a href="http://colorscripter.com/info#e" target="_blank" style="color:#e5e5e5text-decoration:none">Colored by Color Scripter</a></div></td><td style="vertical-align:bottom;padding:0 2px 4px 0"><a href="http://colorscripter.com/info#e" target="_blank" style="text-decoration:none;color:white"><span style="font-size:9px;word-break:normal;background-color:#e5e5e5;color:white;border-radius:10px;padding:1px">cs</span></a></td></tr></table></div>

AppConfig에서 무엇을 사용할지 다 정해서 넣어준다.

AppConfig는 애플리케이션의 실제 동작에 필요한 **구현 객체를 생성**한다 

AppConfig는 생성한 **객체 인스턴스의 참조(레퍼런스)**를 생성자를 통해서 **주입(연결)**해준다.  <br/>=>**생성자 주입**

클라이언트인 OrderServiceImpl 입장에서 보면 discountPolicy에 뭐가 들어올지 모르며 

#### 이것이 마치 **<span style="color:Orange">의존관계를 외부에서 주입</span>**해주는 것 같다고 해서 <span style="color:Orange">**DI(Dependency Injection)**</span>, 우리말로는 <span style="color:Orange">**의존관계 주입**</span>이라 한다.

(참 쉽다 :D)

 <br/>

 <br/>

### 💡좋은 객체 지향 설계의 5가지 원칙의 적용

우리는 **AppConfig**를 통해 다음을 얻을 수 있었다.

- **DIP 의존관계 역전 원칙**

  "프로그래머는 추상화에 의존해야지 구체화에 의존하면 안된다."

  =>**의존성 주입**은 이 원칙을 따르는 방법 중 하나다.

 <br/>

- **OCP** 

  할인 정책을 변경해서 주입하더라도, 클라이언트 코드는 변하지 않는다.

  소프트웨어 요소를 새롭게 확장해도, 사용 영역의 변경은 닫혀있다.

 <br/>

 <br/>

## 💡 IoC, DI, 그리고 컨테이너

### ✏ Ioc : 제어의 역전 (Inversion of Control)

위의 OrderServiceImpl을 보면, 원래는 주문서비스 구현 객체가 스스로 필요한 할인 정책을 연결했다. 즉 구현 객체가 프로그램의 제어 흐름을 스스로 조종한 것이다. 자연스럽다. 

그러나 AppConfig를 사용하면서, 주문서비스 구현 객체는 자신의 로직을 실행하는 역할만 담당한다.

프로그램의 제어 흐름을 AppConfig가 가져간 것이다.

#### **이렇듯 <span style="color:Orange">프로그램의 제어 흐름</span>을 직접 제어하는 것이 아니라 <span style="color:Orange">외부에서 관리</span>하는 것을 <span style="color:Orange">제어의 역전(IoC)</span>이라 한다.**

제어의 역전이란 개념은 프레임워크랑 라이브러리를 구분할때 중요한데

#### ✏ 프레임워크 vs 라이브러리

- 내가 작성한 코드를 **제어하고, 대신 실행**하면 그것은 **프레임워크**이다.
- 내가 작성한 코드가 **직접 제어의 흐름을 담당**한다면, 그것은 프레임워크가 아니라 **라이브러리**이다. 

 <br/>

## 💡 DI : 의존관계 주입

의존관계는 **정적인 클래스 의존관계**와, **동적인 객체 의존관계** 둘을 분리해서 생각해야 한다

 <br/>

#### ✏ 정적인 클래스 의존관계

**import 코드만 보고 의존관계를 파악할 수 있다.**

위의 OrderServiceImpl은 DiscountPolicy에 의존한다는것을 코드만 봐도 알 수 있다.

그러나 이러한 클래스 의존관계 만으로는 어떤 객체가 OrderServiceImpl에 주입될지 알 수 없다.

####  <br/>✏ 동적인 객체 인스턴스 의존 관계

- **애플리케이션 <span style="color:Orange">실행 시점</span>에 실제 <span style="color:Orange">생성된 객체 인스턴스의 참조가 연결</span>된 의존 관계** 

- **애플리케이션 <span style="color:Orange">실행 시점(런타임)</span>에 외부에서 실제 구현 객체를 생성하고 클라이언트에 전달해서 클라이언트와 서버의 실제 의존관계가 연결 되는 것을 <span style="color:Orange">DI(의존관계 주입)</span>라 한다** 

- **의존관계 주입을 사용**하면 정적인 클래스 의존관계를 변경하지 않고, **동적인 객체 인스턴스 의존관계를 쉽게 변경**할 수 있다.

 <br/>

 <br/>

## 💡 Ioc컨테이너, DI 컨테이너

Ioc를 해주는 컨테이너, DI를 해주는 컨테이너라 보면 된다. 

AppConfig 처럼 객체를 생성하고 관리하면서 의존관계를 연결해 주는 것을 

IoC컨테이너 또는 **DI 컨테이너**라 한다. 

(IoC는 너무 범용적이라, DI컨테이너가 좀 더 맞는 말 같다 :D)

 <br/>

 <br/>

## 🧾 정리

### 💡 DI - 의존관계 주입

- **클래스 모델이나 코드상에 <span style="color:Orange">런타임 시점의 의존관계가 드러나지 않는다.</span>** 

  **=> <span style="color:Orange">인터페이스에만 의존</span>하고 있어야 한다.**

- **<span style="color:Orange">런타임 시점의 의존관계는</span> 컨테이너나 팩토리 같은 <span style="color:Orange">제3의 존재가 결정</span>한다.**

- **의존관계는 사용할 오브젝트에 대한 레퍼런스를 외부에서 제공해줌으로써 만들어진다.**

 **<span style="color:Orange">설계 시점에는 알지 못했던</span> 두 오브젝트의 관계를 맺도록 도와주는 <span style="color:Orange">제3의 존재</span>가 있다는 것**

**제3의 존재로 인해 클라이언트와 서버의 실제 의존관계가 연결 되는 것을 <span style="color:Orange">DI(의존관계 주입)</span>이라 한다**

 <br/>

즉 스프링의 경우

 <br/>

#### 어떤 객체에 <span style="color:Orange">스프링 컨테이너</span>가 또 다른 객체와 <span style="color:Orange">의존성을 맺어주는</span> 행위

 <br/>

 <br/>

### 💡IoC - 제어의 역전

**<span style="color:Orange">프로그램의 제어 흐름</span>을 직접 제어하는 것이 아니라 <span style="color:Orange">외부에서 관리</span>하는 것을 <span style="color:Orange">제어의 역전(IoC)</span>이라 한다.**

 <br/>

즉 스프링의 경우

 <br/>

#### <span style="color:Orange">스프링 컨테이너</span>가 필요에 따라 개발자 대신 <span style="color:Orange">Bean들을 관리(제어)</span>해주는 행위

 <br/>

 <br/>

### 💡 Ioc컨테이너, DI 컨테이너

##### <span style="color:Orange">객체를 생성하고 관리(IoC)</span>하면서 <span style="color:Orange">의존관계를 연결(DI)</span>해 주는 컨테이너를 IoC컨테이너 또는 <span style="color:Orange">DI 컨테이너</span>라 한다

##### <span style="color:Orange">스프링 컨테이너</span>는 <span style="color:Orange">DI컨테이너</span>이다. :D

 <br/>

 <br/>

 <br/>

### 지금까지도 아직 스프링을 사용하지 않았다!

### 기본 개념과 핵심 원리에 대해서만 공부했는데도.. 엄청 많다!

### 다음 글부터는 정말 스프링을 사용해보며 스프링에 대해 공부해보겠다!

